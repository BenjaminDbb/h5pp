

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Program Listing for File h5ppHdf5.h &mdash; h5pp  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> h5pp
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../README.html">h5pp</a></li>
<li class="toctree-l1"><a class="reference internal" href="../README.html#to-do">To-do</a></li>
<li class="toctree-l1"><a class="reference internal" href="library_root.html">Library API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">h5pp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Program Listing for File h5ppHdf5.h</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/program_listing_file__home_david_GitProjects_h5pp_h5pp_include_h5pp_details_h5ppHdf5.h.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="program-listing-for-file-h5pphdf5-h">
<span id="program-listing-file-home-david-gitprojects-h5pp-h5pp-include-h5pp-details-h5pphdf5-h"></span><h1>Program Listing for File h5ppHdf5.h<a class="headerlink" href="#program-listing-for-file-h5pphdf5-h" title="Permalink to this headline">¶</a></h1>
<p>↰ <a class="reference internal" href="file__home_david_GitProjects_h5pp_h5pp_include_h5pp_details_h5ppHdf5.h.html#file-home-david-gitprojects-h5pp-h5pp-include-h5pp-details-h5pphdf5-h"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">/home/david/GitProjects/h5pp/h5pp/include/h5pp/details/h5ppHdf5.h</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppEigen.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppEnums.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppFilesystem.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppHyperslab.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppInfo.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppLogger.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppPropertyLists.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppTypeSfinae.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;h5ppUtils.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;hdf5.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;map&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;typeindex&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;utility&gt;</span><span class="cp"></span>
<span class="k">namespace</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span> <span class="p">{</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span> <span class="n">pathCumulativeSplit</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">strv</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">delim</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">&gt;</span> <span class="n">output</span><span class="p">;</span>
        <span class="kt">size_t</span>                        <span class="n">currentPosition</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">currentPosition</span> <span class="o">&lt;</span> <span class="n">strv</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">foundPosition</span> <span class="o">=</span> <span class="n">strv</span><span class="p">.</span><span class="n">find_first_of</span><span class="p">(</span><span class="n">delim</span><span class="p">,</span> <span class="n">currentPosition</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">currentPosition</span> <span class="o">!=</span> <span class="n">foundPosition</span><span class="p">)</span> <span class="p">{</span> <span class="n">output</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">strv</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">foundPosition</span><span class="p">));</span> <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">foundPosition</span> <span class="o">==</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
            <span class="n">currentPosition</span> <span class="o">=</span> <span class="n">foundPosition</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of_v</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">hid_base</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">h5x</span><span class="o">&gt;&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">getName</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">object</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buf</span><span class="p">;</span>
        <span class="kt">ssize_t</span>     <span class="n">namesize</span> <span class="o">=</span> <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">namesize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">buf</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">namesize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">object</span><span class="p">,</span> <span class="n">buf</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">namesize</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">getRank</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">space</span><span class="p">);</span> <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">getRank</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dset</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dset</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getRank</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">getRank</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Aget_space</span><span class="p">(</span><span class="n">attr</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getRank</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">hsize_t</span> <span class="n">getSize</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">H5Sget_simple_extent_npoints</span><span class="p">(</span><span class="n">space</span><span class="p">));</span> <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">hsize_t</span> <span class="n">getSize</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getSize</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">hsize_t</span> <span class="n">getSize</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="o">&amp;</span><span class="n">attribute</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Aget_space</span><span class="p">(</span><span class="n">attribute</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getSize</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">hsize_t</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">H5Sget_select_npoints</span><span class="p">(</span><span class="n">space</span><span class="p">));</span> <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">getDimensions</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">ndims</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ndims</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to get dimensions&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">dims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ndims</span><span class="p">));</span>
        <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">dims</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">dims</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">getDimensions</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getDimensions</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">getDimensions</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="o">&amp;</span><span class="n">attribute</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Aget_space</span><span class="p">(</span><span class="n">attribute</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getDimensions</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">H5D_layout_t</span> <span class="n">getLayout</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">dataset_creation_property_list</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">H5Pget_layout</span><span class="p">(</span><span class="n">dataset_creation_property_list</span><span class="p">);</span> <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">H5D_layout_t</span> <span class="n">getLayout</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="n">dcpl</span> <span class="o">=</span> <span class="n">H5Dget_create_plist</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">H5Pget_layout</span><span class="p">(</span><span class="n">dcpl</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;&gt;</span> <span class="n">getChunkDimensions</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">dsetCreatePropertyList</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">H5Pget_layout</span><span class="p">(</span><span class="n">dsetCreatePropertyList</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">layout</span> <span class="o">!=</span> <span class="n">H5D_CHUNKED</span><span class="p">)</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
        <span class="k">auto</span> <span class="n">ndims</span> <span class="o">=</span> <span class="n">H5Pget_chunk</span><span class="p">(</span><span class="n">dsetCreatePropertyList</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">ndims</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to get chunk dimensions&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">ndims</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">chunkDims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ndims</span><span class="p">));</span>
            <span class="n">H5Pget_chunk</span><span class="p">(</span><span class="n">dsetCreatePropertyList</span><span class="p">,</span> <span class="n">ndims</span><span class="p">,</span> <span class="n">chunkDims</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
            <span class="k">return</span> <span class="n">chunkDims</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span>
            <span class="k">return</span> <span class="p">{};</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;&gt;</span> <span class="n">getChunkDimensions</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="n">dcpl</span> <span class="o">=</span> <span class="n">H5Dget_create_plist</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getChunkDimensions</span><span class="p">(</span><span class="n">dcpl</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;&gt;</span> <span class="n">getMaxDimensions</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="n">H5D_layout_t</span> <span class="n">layout</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">layout</span> <span class="o">!=</span> <span class="n">H5D_CHUNKED</span><span class="p">)</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_simple_extent_type</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="o">!=</span> <span class="n">H5S_SIMPLE</span><span class="p">)</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">rank</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to get dimensions&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">maxdims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rank</span><span class="p">));</span>
        <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">maxdims</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">maxdims</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;&gt;</span> <span class="n">getMaxDimensions</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="n">dcpl</span>  <span class="o">=</span> <span class="n">H5Dget_create_plist</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getMaxDimensions</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">getLayout</span><span class="p">(</span><span class="n">dcpl</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">herr_t</span> <span class="n">H5Dvlen_get_buf_size_safe</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dset</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="n">hsize_t</span> <span class="o">*</span><span class="n">vlen</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">vlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_simple_extent_type</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="o">!=</span> <span class="n">H5S_SCALAR</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">herr_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dvlen_get_buf_size</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">vlen</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Dget_storage_size</span><span class="p">(</span><span class="n">dset</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">auto</span>                      <span class="n">size</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_npoints</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">vdata</span><span class="p">{</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">)};</span> <span class="c1">// Allocate for pointers for &quot;size&quot; number of strings</span>
        <span class="c1">// HDF5 allocates space for each string</span>
        <span class="n">herr_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dread</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">H5S_ALL</span><span class="p">,</span> <span class="n">H5S_ALL</span><span class="p">,</span> <span class="n">H5P_DEFAULT</span><span class="p">,</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// Sum up the number of bytes</span>
        <span class="kt">size_t</span> <span class="n">max_len</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">constants</span><span class="o">::</span><span class="n">maxSizeContiguous</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">elem</span> <span class="p">:</span> <span class="n">vdata</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">elem</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="o">*</span><span class="n">vlen</span> <span class="o">+=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">strnlen</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">max_len</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Add null-terminator</span>
        <span class="p">}</span>
        <span class="n">H5Dvlen_reclaim</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">H5P_DEFAULT</span><span class="p">,</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">herr_t</span> <span class="n">H5Avlen_get_buf_size_safe</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="n">hsize_t</span> <span class="o">*</span><span class="n">vlen</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">vlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Aget_storage_size</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">auto</span>                      <span class="n">size</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_npoints</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">vdata</span><span class="p">{</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">)};</span> <span class="c1">// Allocate pointers for &quot;size&quot; number of strings</span>
        <span class="c1">// HDF5 allocates space for each string</span>
        <span class="n">herr_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Aread</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">// Sum up the number of bytes</span>
        <span class="kt">size_t</span> <span class="n">maxLen</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">constants</span><span class="o">::</span><span class="n">maxSizeCompact</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">elem</span> <span class="p">:</span> <span class="n">vdata</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">elem</span> <span class="o">==</span> <span class="k">nullptr</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
            <span class="o">*</span><span class="n">vlen</span> <span class="o">+=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">strnlen</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">maxLen</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Add null-terminator</span>
        <span class="p">}</span>
        <span class="n">H5Dvlen_reclaim</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">H5P_DEFAULT</span><span class="p">,</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">size_t</span> <span class="n">getBytesPerElem</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">h5Type</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">h5Type</span><span class="p">);</span> <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">size_t</span> <span class="n">getBytesTotal</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getBytesPerElem</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">*</span> <span class="n">getSize</span><span class="p">(</span><span class="n">space</span><span class="p">);</span> <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">size_t</span> <span class="n">getBytesTotal</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dset</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5s</span><span class="o">&gt;</span> <span class="n">space</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5t</span><span class="o">&gt;</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">type</span><span class="p">)</span> <span class="n">type</span> <span class="o">=</span> <span class="n">H5Dget_type</span><span class="p">(</span><span class="n">dset</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">space</span><span class="p">)</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dset</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">hsize_t</span> <span class="n">vlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">herr_t</span>  <span class="n">err</span>  <span class="o">=</span> <span class="n">H5Dvlen_get_buf_size_safe</span><span class="p">(</span><span class="n">dset</span><span class="p">,</span> <span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">vlen</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">vlen</span><span class="p">;</span> <span class="c1">// Returns the total number of bytes required to store the dataset</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="nf">getBytesTotal</span><span class="p">(</span><span class="n">space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">getBytesTotal</span><span class="p">(</span><span class="n">space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">size_t</span> <span class="n">getBytesTotal</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5s</span><span class="o">&gt;</span> <span class="n">space</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5t</span><span class="o">&gt;</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">type</span><span class="p">)</span> <span class="n">type</span> <span class="o">=</span> <span class="n">H5Aget_type</span><span class="p">(</span><span class="n">attr</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">space</span><span class="p">)</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Aget_space</span><span class="p">(</span><span class="n">attr</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">hsize_t</span> <span class="n">vlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">herr_t</span>  <span class="n">err</span>  <span class="o">=</span> <span class="n">H5Avlen_get_buf_size_safe</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="o">&amp;</span><span class="n">vlen</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">vlen</span><span class="p">;</span> <span class="c1">// Returns the total number of bytes required to store the dataset</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="nf">getBytesTotal</span><span class="p">(</span><span class="n">space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">getBytesTotal</span><span class="p">(</span><span class="n">space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">size_t</span> <span class="n">getBytesSelected</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">getBytesPerElem</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">*</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">space</span><span class="p">);</span> <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">assertWriteBufferIsLargeEnough</span><span class="p">(</span><span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tget_class</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">type</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// This transfers the string from memory until finding a null terminator</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">auto</span> <span class="n">hdf5Byte</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">type</span><span class="p">);</span> <span class="c1">// Chars including null-terminator. The memory buffer must fit this size. Also, these many bytes will participate in IO</span>
                <span class="k">auto</span> <span class="n">hdf5Size</span> <span class="o">=</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
                <span class="k">auto</span> <span class="n">dataByte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getCharArraySize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span> <span class="c1">// Allocated chars including null terminator</span>
                <span class="k">auto</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">dataByte</span> <span class="o">&lt;</span> <span class="n">hdf5Byte</span><span class="p">)</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;The text buffer given for this write operation is smaller than the selected space in memory.</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> Data transfer would read from memory out of bounds</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> given    : num strings {} | bytes {} = {} chars + &#39;</span><span class="se">\\</span><span class="s">0&#39;</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> selected : num strings {} | bytes {} = {} chars + &#39;</span><span class="se">\\</span><span class="s">0&#39;</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> type     : [{}]&quot;</span><span class="p">,</span>
                                                          <span class="n">dataSize</span><span class="p">,</span>
                                                          <span class="n">dataByte</span><span class="p">,</span>
                                                          <span class="n">dataByte</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                          <span class="n">hdf5Size</span><span class="p">,</span>
                                                          <span class="n">hdf5Byte</span><span class="p">,</span>
                                                          <span class="n">hdf5Byte</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                          <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">not</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_size_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">auto</span> <span class="n">hdf5Size</span> <span class="o">=</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">hdf5Byte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">*</span> <span class="n">hdf5Size</span><span class="p">;</span>
            <span class="k">auto</span> <span class="n">dataByte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dataByte</span> <span class="o">&lt;</span> <span class="n">hdf5Byte</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;The buffer given for this write operation is smaller than the selected space in memory.</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> Data transfer would read from memory out of bounds</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> given   : size {} | bytes {}</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> selected: size {} | bytes {}</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> type     : [{}]&quot;</span><span class="p">,</span>
                                                      <span class="n">dataSize</span><span class="p">,</span>
                                                      <span class="n">dataByte</span><span class="p">,</span>
                                                      <span class="n">hdf5Size</span><span class="p">,</span>
                                                      <span class="n">hdf5Byte</span><span class="p">,</span>
                                                      <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">assertReadBufferIsLargeEnough</span><span class="p">(</span><span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tget_class</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">type</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// These are resized on the fly</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">auto</span> <span class="n">hdf5Byte</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">type</span><span class="p">);</span> <span class="c1">// Chars including null-terminator. The memory buffer must fit this size. Also, these many bytes will participate in IO</span>
                <span class="k">auto</span> <span class="n">hdf5Size</span> <span class="o">=</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
                <span class="k">auto</span> <span class="n">dataByte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getCharArraySize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Chars including null terminator</span>
                <span class="k">auto</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">dataByte</span> <span class="o">&lt;</span> <span class="n">hdf5Byte</span><span class="p">)</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;The text buffer allocated for this read operation is smaller than the string buffer found on the dataset.</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> Data transfer would write into memory out of bounds</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> allocated buffer: num strings {} | bytes {} = {} chars + &#39;</span><span class="se">\\</span><span class="s">0&#39;</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> selected  buffer: num strings {} | bytes {} = {} chars + &#39;</span><span class="se">\\</span><span class="s">0&#39;</span><span class="se">\n</span><span class="s">&quot;</span>
                                                          <span class="s">&quot;</span><span class="se">\t</span><span class="s"> type     : [{}]&quot;</span><span class="p">,</span>
                                                          <span class="n">dataSize</span><span class="p">,</span>
                                                          <span class="n">dataByte</span><span class="p">,</span>
                                                          <span class="n">dataByte</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                          <span class="n">hdf5Size</span><span class="p">,</span>
                                                          <span class="n">hdf5Byte</span><span class="p">,</span>
                                                          <span class="n">hdf5Byte</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                                                          <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">not</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_size_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="k">auto</span> <span class="n">hdf5Size</span> <span class="o">=</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">hdf5Byte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">*</span> <span class="n">hdf5Size</span><span class="p">;</span>
            <span class="k">auto</span> <span class="n">dataByte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dataByte</span> <span class="o">&lt;</span> <span class="n">hdf5Byte</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;The buffer allocated for this read operation is smaller than the selected space in memory.</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> Data transfer would write into memory out of bounds</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> allocated : size {} | bytes {}</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> selected  : size {} | bytes {}</span><span class="se">\n</span><span class="s">&quot;</span>
                                                      <span class="s">&quot;</span><span class="se">\t</span><span class="s"> type     : [{}]&quot;</span><span class="p">,</span>
                                                      <span class="n">dataSize</span><span class="p">,</span>
                                                      <span class="n">dataByte</span><span class="p">,</span>
                                                      <span class="n">hdf5Size</span><span class="p">,</span>
                                                      <span class="n">hdf5Byte</span><span class="p">,</span>
                                                      <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">userDataType</span><span class="o">&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kt">bool</span> <span class="n">checkBytesPerElemMatch</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">h5Type</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">dsetTypeSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="p">(</span><span class="n">h5Type</span><span class="p">);</span>
        <span class="kt">size_t</span> <span class="n">dataTypeSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="o">&lt;</span><span class="n">userDataType</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tget_class</span><span class="p">(</span><span class="n">h5Type</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span> <span class="n">dsetTypeSize</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">H5T_C_S1</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dataTypeSize</span> <span class="o">!=</span> <span class="n">dsetTypeSize</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// The dsetType may have been generated by H5Tpack, in which case we should check against the native type</span>
            <span class="kt">size_t</span>   <span class="n">packedTypesize</span> <span class="o">=</span> <span class="n">dsetTypeSize</span><span class="p">;</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="n">nativetype</span>     <span class="o">=</span> <span class="n">H5Tget_native_type</span><span class="p">(</span><span class="n">h5Type</span><span class="p">,</span> <span class="n">H5T_DIR_ASCEND</span><span class="p">);</span>
            <span class="n">dsetTypeSize</span>            <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="p">(</span><span class="n">nativetype</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dataTypeSize</span> <span class="o">!=</span> <span class="n">dsetTypeSize</span><span class="p">)</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Type size mismatch: dataset type {} bytes | given type {} bytes&quot;</span><span class="p">,</span> <span class="n">dsetTypeSize</span><span class="p">,</span> <span class="n">dataTypeSize</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Detected packed HDF5 type: packed size {} bytes | native size {} bytes. This is not supported by h5pp yet!&quot;</span><span class="p">,</span> <span class="n">packedTypesize</span><span class="p">,</span> <span class="n">dataTypeSize</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">dataTypeSize</span> <span class="o">==</span> <span class="n">dsetTypeSize</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">not</span> <span class="n">std</span><span class="o">::</span><span class="n">is_base_of_v</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">hid_base</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DataType</span><span class="o">&gt;&gt;&gt;</span>
    <span class="kt">void</span> <span class="n">assertBytesPerElemMatch</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">h5Type</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//        if(h5pp::type::sfinae::is_container_of_v&lt;DataType,std::string&gt;) return; // Each element is potentially a different length!</span>
        <span class="kt">size_t</span> <span class="n">dsetTypeSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="p">(</span><span class="n">h5Type</span><span class="p">);</span>
        <span class="kt">size_t</span> <span class="n">dataTypeSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tget_class</span><span class="p">(</span><span class="n">h5Type</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span> <span class="n">dsetTypeSize</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">H5T_C_S1</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dataTypeSize</span> <span class="o">!=</span> <span class="n">dsetTypeSize</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// The dsetType may have been generated by H5Tpack, in which case we should check against the native type</span>
            <span class="kt">size_t</span>   <span class="n">packedTypesize</span> <span class="o">=</span> <span class="n">dsetTypeSize</span><span class="p">;</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="n">nativetype</span>     <span class="o">=</span> <span class="n">H5Tget_native_type</span><span class="p">(</span><span class="n">h5Type</span><span class="p">,</span> <span class="n">H5T_DIR_ASCEND</span><span class="p">);</span>
            <span class="n">dsetTypeSize</span>            <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getBytesPerElem</span><span class="p">(</span><span class="n">nativetype</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dataTypeSize</span> <span class="o">!=</span> <span class="n">dsetTypeSize</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Type size mismatch: dataset type is [{}] bytes | Type of given data is [{}] bytes&quot;</span><span class="p">,</span> <span class="n">dsetTypeSize</span><span class="p">,</span> <span class="n">dataTypeSize</span><span class="p">));</span>
            <span class="k">else</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Detected packed HDF5 type: packed size {} bytes | native size {} bytes. This is not supported by h5pp yet!&quot;</span><span class="p">,</span> <span class="n">packedTypesize</span><span class="p">,</span> <span class="n">dataTypeSize</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setStringSize</span><span class="p">(</span><span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">,</span> <span class="n">hsize_t</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">,</span> <span class="kt">size_t</span> <span class="o">&amp;</span><span class="n">bytes</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">dims</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">H5T_class_t</span> <span class="n">dataClass</span> <span class="o">=</span> <span class="n">H5Tget_class</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dataClass</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// The datatype may either be text or a container of text.</span>
            <span class="c1">// Examples of pure text are std::string or char[]</span>
            <span class="c1">// Example of a container of text is std::vector&lt;std::string&gt;</span>
            <span class="c1">// When</span>
            <span class="c1">//      1) it is pure text and dimensions are {}</span>
            <span class="c1">//          * Space is H5S_SCALAR because dimensions are {}</span>
            <span class="c1">//          * Rank is 0 because dimensions are {}</span>
            <span class="c1">//          * Size is 1 because size = prod 1*dim(i) * dim(j)...</span>
            <span class="c1">//          * We set size H5T_VARIABLE</span>
            <span class="c1">//      2) it is pure text and dimensions were specified other than {}</span>
            <span class="c1">//          * Space is H5S_SIMPLE</span>
            <span class="c1">//          * Rank is 1 or more because dimensions were given as {i,j,k...}</span>
            <span class="c1">//          * Size is n, because size = prod 1*dim(i) * dim(j)...</span>
            <span class="c1">//          * Here n is number of chars to get from the string buffer</span>
            <span class="c1">//          * We set the string size to n because each element is a char.</span>
            <span class="c1">//          * We set the dimension to {1}</span>
            <span class="c1">//      3) it is a container of text</span>
            <span class="c1">//          * Space is H5S_SIMPLE</span>
            <span class="c1">//          * The rank is 1 or more</span>
            <span class="c1">//          * The space size is the number of strings in the container</span>
            <span class="c1">//          * We set size H5T_VARIABLE</span>
            <span class="c1">//          * The dimensions remain the size of the container</span>

            <span class="k">if</span><span class="p">(</span><span class="n">H5Tget_size</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// String properties have already been set, probably by the user</span>

            <span class="n">herr_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">dims</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
                    <span class="c1">// Case 1</span>
                    <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_VARIABLE</span><span class="p">);</span>
                    <span class="n">bytes</span>  <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// Case 2</span>
                    <span class="n">hsize_t</span> <span class="n">desiredSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getSizeFromDimensions</span><span class="p">(</span><span class="n">dims</span><span class="p">);</span>
                    <span class="c1">// Consider a case where the text is &quot;this is a text&quot;</span>
                    <span class="c1">// but the desired size is 12.</span>
                    <span class="c1">// The resulting string should be &quot;this is a t&#39;\0&#39;&quot;,</span>
                    <span class="c1">// with 12 characters in total including the null terminator.</span>
                    <span class="c1">// HDF5 seems to do this automatically. From the manual:</span>
                    <span class="c1">// &quot;If the short string is H5T_STR_NULLTERM, it is truncated</span>
                    <span class="c1">// and a null terminator is appended.&quot;</span>
                    <span class="c1">// Furthermore</span>
                    <span class="c1">// &quot;The size set for a string datatype should include space for</span>
                    <span class="c1">// the null-terminator character, otherwise it will not be</span>
                    <span class="c1">// stored on (or retrieved from) disk&quot;</span>
                    <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">desiredSize</span><span class="p">);</span> <span class="c1">// Desired size should be num chars + null terminator</span>
                    <span class="n">dims</span>   <span class="o">=</span> <span class="p">{};</span>
                    <span class="n">size</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">bytes</span>  <span class="o">=</span> <span class="n">desiredSize</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Case 3</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Tset_size</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_VARIABLE</span><span class="p">);</span>
                <span class="n">bytes</span>  <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to set size on string&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// The following makes sure there is a single &quot;\0&quot; at the end of the string when written to file.</span>
            <span class="c1">// Note however that bytes here is supposed to be the number of characters including null terminator.</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Tset_strpad</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_STR_NULLTERM</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to set strpad&quot;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="c1">// Sets the character set to UTF-8</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Tset_cset</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_cset_t</span><span class="o">::</span><span class="n">H5T_CSET_UTF8</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to set char-set UTF-8&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc_or_hid_t</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">bool</span>
        <span class="n">checkIfLinkExists</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">linkExists</span><span class="p">)</span> <span class="k">return</span> <span class="n">linkExists</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
        <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">subPath</span> <span class="p">:</span> <span class="n">pathCumulativeSplit</span><span class="p">(</span><span class="n">linkPath</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">))</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">exists</span> <span class="o">=</span> <span class="n">H5Lexists</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">subPath</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">linkAccess</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">exists</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Checking if link exists [{}] ... false&quot;</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">);</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">exists</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to check if link exists [{}]&quot;</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Checking if link exists [{}] ... true&quot;</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc_or_hid_t</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">bool</span>
        <span class="n">checkIfDatasetExists</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">dsetName</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">dsetExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">dsetAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetExists</span><span class="p">)</span> <span class="k">return</span> <span class="n">dsetExists</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
        <span class="n">dsetExists</span> <span class="o">=</span> <span class="n">checkIfLinkExists</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">dsetName</span><span class="p">,</span> <span class="n">dsetExists</span><span class="p">,</span> <span class="n">dsetAccess</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetExists</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5o</span>   <span class="n">object</span>     <span class="o">=</span> <span class="n">H5Oopen</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">dsetName</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">dsetAccess</span><span class="p">);</span>
        <span class="n">H5I_type_t</span> <span class="n">objectType</span> <span class="o">=</span> <span class="n">H5Iget_type</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">objectType</span> <span class="o">!=</span> <span class="n">H5I_DATASET</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Checking if link is a dataset [{}] ... false&quot;</span><span class="p">,</span> <span class="n">dsetName</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Checking if link is a dataset [{}] ... true&quot;</span><span class="p">,</span> <span class="n">dsetName</span><span class="p">);</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="n">h5x_loc</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc_or_hid_t</span><span class="o">&lt;</span><span class="n">h5x_loc</span><span class="o">&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="n">h5x</span> <span class="n">openLink</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x_loc</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">checkIfLinkExists</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">linkExists</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Opening dataset [{}]&quot;</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">);</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5g</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Opening group [</span><span class="p">{}]</span><span class="s">&quot;, linkPath);</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5o</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Opening object [</span><span class="p">{}]</span><span class="s">&quot;, linkPath);</span>
            <span class="n">h5x</span> <span class="n">link</span><span class="p">;</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">link</span> <span class="o">=</span> <span class="n">H5Dopen</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">linkPath</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">linkAccess</span><span class="p">);</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5g</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">link</span> <span class="o">=</span> <span class="n">H5Gopen</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">linkPath</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">linkAccess</span><span class="p">);</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5o</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">link</span> <span class="o">=</span> <span class="n">H5Oopen</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">linkPath</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">linkAccess</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">link</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to open existing link [{}]&quot;</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">link</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Link does not exist [{}]&quot;</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_link_or_hid_t</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">checkIfAttributeExists</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span>         <span class="n">link</span><span class="p">,</span>
                                                     <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>    <span class="n">linkPath</span><span class="p">,</span>
                                                     <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>    <span class="n">attrName</span><span class="p">,</span>
                                                     <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">attrExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span>
                                                     <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span>    <span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">attrExists</span> <span class="n">and</span> <span class="n">attrExists</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Checking if attribute [{}] exitst in link [{}]&quot;</span><span class="p">,</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">);</span>
        <span class="kt">bool</span> <span class="n">exists</span> <span class="o">=</span> <span class="n">H5Aexists_by_name</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">attrName</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">linkAccess</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Checking if attribute [{}] exitst in link [{}] ... {}&quot;</span><span class="p">,</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">exists</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">exists</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc_or_hid_t</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">checkIfAttributeExists</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span>         <span class="n">loc</span><span class="p">,</span>
                                                     <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>    <span class="n">linkPath</span><span class="p">,</span>
                                                     <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>    <span class="n">attrName</span><span class="p">,</span>
                                                     <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span>
                                                     <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">attrExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span>
                                                     <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span>    <span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">linkExists</span> <span class="n">and</span> <span class="n">attrExists</span> <span class="n">and</span> <span class="n">linkExists</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="n">and</span> <span class="n">attrExists</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">auto</span> <span class="n">link</span> <span class="o">=</span> <span class="n">openLink</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5o</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">linkExists</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">checkIfAttributeExists</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">attrExists</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type1</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If types are compound, check recursively that all members have equal types and names</span>
        <span class="n">H5T_class_t</span> <span class="n">dataClass1</span> <span class="o">=</span> <span class="n">H5Tget_class</span><span class="p">(</span><span class="n">type1</span><span class="p">);</span>
        <span class="n">H5T_class_t</span> <span class="n">dataClass2</span> <span class="o">=</span> <span class="n">H5Tget_class</span><span class="p">(</span><span class="n">type1</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dataClass1</span> <span class="o">==</span> <span class="n">H5T_COMPOUND</span> <span class="n">and</span> <span class="n">dataClass2</span> <span class="o">==</span> <span class="n">H5T_COMPOUND</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">size_t</span> <span class="n">sizeType1</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">type1</span><span class="p">);</span>
            <span class="kt">size_t</span> <span class="n">sizeType2</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">type2</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">sizeType1</span> <span class="o">!=</span> <span class="n">sizeType2</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="k">auto</span> <span class="n">nMembers1</span> <span class="o">=</span> <span class="n">H5Tget_nmembers</span><span class="p">(</span><span class="n">type1</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">nMembers2</span> <span class="o">=</span> <span class="n">H5Tget_nmembers</span><span class="p">(</span><span class="n">type2</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">nMembers1</span> <span class="o">!=</span> <span class="n">nMembers2</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">nMembers1</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span>         <span class="n">t1</span>    <span class="o">=</span> <span class="n">H5Tget_member_type</span><span class="p">(</span><span class="n">type1</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
                <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span>         <span class="n">t2</span>    <span class="o">=</span> <span class="n">H5Tget_member_type</span><span class="p">(</span><span class="n">type2</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
                <span class="kt">char</span> <span class="o">*</span>           <span class="n">mem1</span>  <span class="o">=</span> <span class="n">H5Tget_member_name</span><span class="p">(</span><span class="n">type1</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
                <span class="kt">char</span> <span class="o">*</span>           <span class="n">mem2</span>  <span class="o">=</span> <span class="n">H5Tget_member_name</span><span class="p">(</span><span class="n">type2</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">n1</span>    <span class="o">=</span> <span class="n">mem1</span><span class="p">;</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">n2</span>    <span class="o">=</span> <span class="n">mem2</span><span class="p">;</span>
                <span class="kt">bool</span>             <span class="n">equal</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">==</span> <span class="n">n2</span><span class="p">;</span>
                <span class="n">H5free_memory</span><span class="p">(</span><span class="n">mem1</span><span class="p">);</span>
                <span class="n">H5free_memory</span><span class="p">(</span><span class="n">mem2</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">equal</span><span class="p">)</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">))</span> <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">dataClass1</span> <span class="o">==</span> <span class="n">dataClass2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dataClass1</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="n">type1</span> <span class="o">==</span> <span class="n">type2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">checkIfCompressionIsAvailable</span><span class="p">()</span> <span class="p">{</span>
        <span class="cm">/*</span>
<span class="cm">         * Check if zlib compression is available and can be used for both</span>
<span class="cm">         * compression and decompression. We do not throw errors because this</span>
<span class="cm">         * filter is an optional part of the hdf5 library.</span>
<span class="cm">         */</span>
        <span class="n">htri_t</span> <span class="n">zlibAvail</span> <span class="o">=</span> <span class="n">H5Zfilter_avail</span><span class="p">(</span><span class="n">H5Z_FILTER_DEFLATE</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">zlibAvail</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">filterInfo</span><span class="p">;</span>
            <span class="n">H5Zget_filter_info</span><span class="p">(</span><span class="n">H5Z_FILTER_DEFLATE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">filterInfo</span><span class="p">);</span>
            <span class="kt">bool</span> <span class="n">zlib_encode</span> <span class="o">=</span> <span class="p">(</span><span class="n">filterInfo</span> <span class="o">&amp;</span> <span class="n">H5Z_FILTER_CONFIG_ENCODE_ENABLED</span><span class="p">);</span>
            <span class="kt">bool</span> <span class="n">zlib_decode</span> <span class="o">=</span> <span class="p">(</span><span class="n">filterInfo</span> <span class="o">&amp;</span> <span class="n">H5Z_FILTER_CONFIG_DECODE_ENABLED</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">zlibAvail</span> <span class="n">and</span> <span class="n">zlib_encode</span> <span class="n">and</span> <span class="n">zlib_decode</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">getValidCompressionLevel</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="n">desiredCompressionLevel</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">checkIfCompressionIsAvailable</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">desiredCompressionLevel</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">desiredCompressionLevel</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="n">desiredCompressionLevel</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Given compression level {} is too high. Expected value 0 (min) to 9 (max). Returning 9&quot;</span><span class="p">);</span>
                    <span class="k">return</span> <span class="mi">9</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Compression is not available with this HDF5 library&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_link</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">getAttributeNames</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">link</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span>                     <span class="n">numAttrs</span> <span class="o">=</span> <span class="n">H5Aget_num_attrs</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">attrNames</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numAttrs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="n">attrId</span>  <span class="o">=</span> <span class="n">H5Aopen_idx</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
            <span class="kt">ssize_t</span>  <span class="n">bufSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">bufSize</span>          <span class="o">=</span> <span class="n">H5Aget_name</span><span class="p">(</span><span class="n">attrId</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">),</span> <span class="k">nullptr</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">bufSize</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buf</span><span class="p">;</span>
                <span class="n">buf</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">H5Aget_name</span><span class="p">(</span><span class="n">attrId</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buf</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                <span class="n">attrNames</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Failed to get attribute names&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">attrNames</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span>
        <span class="n">getAttributeNames</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">link</span> <span class="o">=</span> <span class="n">openLink</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5o</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">linkExists</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getAttributeNames</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">type_index</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">getCppType</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span><span class="k">typeid</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">)};</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">tuple</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">type_index</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">getCppType</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_SHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">short</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_INT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_LONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_LLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_USHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_UINT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_ULONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_ULLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_DOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_LDOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">double</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_FLOAT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_HBOOL</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5T_NATIVE_CHAR</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">H5Tcopy</span><span class="p">(</span><span class="n">H5T_C_S1</span><span class="p">)))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_SHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">short</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_INT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_LONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_LLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_USHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_UINT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_ULONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_ULLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_DOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_LDOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_COMPLEX_FLOAT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">complex</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_SHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">short</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_INT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_LONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_LLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_USHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_UINT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_ULONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_ULLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_DOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_LDOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2_FLOAT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR2</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_SHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">short</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_INT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_LONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_LLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_USHORT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_UINT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_ULONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_ULLONG</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_DOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_LDOUBLE</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">long</span> <span class="kt">double</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tequal_recurse</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3_FLOAT</span><span class="p">))</span> <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">compound</span><span class="o">::</span><span class="n">H5T_SCALAR3</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tcommitted</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">auto</span> <span class="n">bufSize</span> <span class="o">=</span> <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;buf_size {}&quot;</span><span class="p">,</span> <span class="n">bufSize</span><span class="p">);</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">bufSize</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">name</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">type</span><span class="p">,</span> <span class="n">name</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;No C++ type match for HDF5 type [{}]&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;No C++ type match for non-committed HDF5 type&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">getCppType</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">nullopt_t</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">TypeInfo</span> <span class="n">getTypeInfo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">objectPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">objectName</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">h5Space</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">h5Type</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TypeInfo</span> <span class="n">typeInfo</span><span class="p">;</span>
        <span class="n">typeInfo</span><span class="p">.</span><span class="n">h5Name</span>                                                              <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">objectName</span><span class="p">);</span>
        <span class="n">typeInfo</span><span class="p">.</span><span class="n">h5Path</span>                                                              <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">objectPath</span><span class="p">);</span>
        <span class="n">typeInfo</span><span class="p">.</span><span class="n">h5Type</span>                                                              <span class="o">=</span> <span class="n">h5Type</span><span class="p">;</span>
        <span class="n">typeInfo</span><span class="p">.</span><span class="n">h5Rank</span>                                                              <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getRank</span><span class="p">(</span><span class="n">h5Space</span><span class="p">);</span>
        <span class="n">typeInfo</span><span class="p">.</span><span class="n">h5Size</span>                                                              <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">h5Space</span><span class="p">);</span>
        <span class="n">typeInfo</span><span class="p">.</span><span class="n">h5Dims</span>                                                              <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getDimensions</span><span class="p">(</span><span class="n">h5Space</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">typeInfo</span><span class="p">.</span><span class="n">cppTypeIndex</span><span class="p">,</span> <span class="n">typeInfo</span><span class="p">.</span><span class="n">cppTypeName</span><span class="p">,</span> <span class="n">typeInfo</span><span class="p">.</span><span class="n">cppTypeBytes</span><span class="p">)</span> <span class="o">=</span> <span class="n">getCppType</span><span class="p">(</span><span class="n">typeInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">return</span> <span class="n">typeInfo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">TypeInfo</span> <span class="n">getTypeInfo</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dataset</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span>        <span class="n">bufSize</span> <span class="o">=</span> <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">dsetPath</span><span class="p">;</span>
        <span class="n">dsetPath</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dsetPath</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Collecting type info about dataset [{}]&quot;</span><span class="p">,</span> <span class="n">dsetPath</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getTypeInfo</span><span class="p">(</span><span class="n">dsetPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="n">H5Dget_type</span><span class="p">(</span><span class="n">dataset</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="n">TypeInfo</span> <span class="n">getTypeInfo</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">dsetName</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">dsetExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">dsetAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">openLink</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5d</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">dsetName</span><span class="p">,</span> <span class="n">dsetExists</span><span class="p">,</span> <span class="n">dsetAccess</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getTypeInfo</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">TypeInfo</span> <span class="n">getTypeInfo</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="o">&amp;</span><span class="n">attribute</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span>        <span class="n">bufSize</span> <span class="o">=</span> <span class="n">H5Aget_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">attrName</span><span class="p">;</span>
        <span class="n">attrName</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">H5Aget_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">attrName</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="n">bufSize</span> <span class="o">=</span> <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">linkPath</span><span class="p">;</span>
        <span class="n">linkPath</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">size_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">H5Iget_name</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bufSize</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Collecting type info about attribute [{}] in link [{}]&quot;</span><span class="p">,</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getTypeInfo</span><span class="p">(</span><span class="n">linkPath</span><span class="p">,</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">H5Aget_space</span><span class="p">(</span><span class="n">attribute</span><span class="p">),</span> <span class="n">H5Aget_type</span><span class="p">(</span><span class="n">attribute</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="n">TypeInfo</span> <span class="n">getTypeInfo</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span>         <span class="n">loc</span><span class="p">,</span>
                                <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>    <span class="n">linkPath</span><span class="p">,</span>
                                <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>    <span class="n">attrName</span><span class="p">,</span>
                                <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span>
                                <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">attrExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span>
                                <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span>    <span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">link</span> <span class="o">=</span> <span class="n">openLink</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5o</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">linkExists</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">checkIfAttributeExists</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">attrExists</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">H5Aopen_name</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">attrName</span><span class="p">).</span><span class="n">c_str</span><span class="p">());</span>
            <span class="k">return</span> <span class="nf">getTypeInfo</span><span class="p">(</span><span class="n">attribute</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Attribute [{}] does not exist in link [{}]&quot;</span><span class="p">,</span> <span class="n">attrName</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_link</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">TypeInfo</span><span class="o">&gt;</span> <span class="n">getTypeInfo_allAttributes</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">link</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">TypeInfo</span><span class="o">&gt;</span> <span class="n">allAttrInfo</span><span class="p">;</span>
        <span class="kt">int</span>                   <span class="n">num_attrs</span> <span class="o">=</span> <span class="n">H5Aget_num_attrs</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">num_attrs</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to get number of attributes in link&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">num_attrs</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5a</span> <span class="n">attribute</span> <span class="o">=</span> <span class="n">H5Aopen_idx</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">idx</span><span class="p">));</span>
            <span class="n">allAttrInfo</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">getTypeInfo</span><span class="p">(</span><span class="n">attribute</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">allAttrInfo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">TypeInfo</span><span class="o">&gt;</span>
        <span class="n">getTypeInfo_allAttributes</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">link</span> <span class="o">=</span> <span class="n">openLink</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5o</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">linkExists</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
        <span class="k">return</span> <span class="nf">getTypeInfo_allAttributes</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">createGroup</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">groupRelativeName</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Check if group exists already</span>
        <span class="n">linkExists</span> <span class="o">=</span> <span class="n">checkIfLinkExists</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">groupRelativeName</span><span class="p">,</span> <span class="n">linkExists</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkAccess</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">linkExists</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Group already exists [{}]&quot;</span><span class="p">,</span> <span class="n">groupRelativeName</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Creating group link [{}]&quot;</span><span class="p">,</span> <span class="n">groupRelativeName</span><span class="p">);</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5g</span> <span class="n">group</span> <span class="o">=</span> <span class="n">H5Gcreate</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">groupRelativeName</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkCreate</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">groupCreate</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">groupAccess</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">writeSymbolicLink</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">srcPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">tgtPath</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">checkIfLinkExists</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkAccess</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Creating symbolic link [{}] --&gt; [{}]&quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">,</span> <span class="n">tgtPath</span><span class="p">);</span>
            <span class="n">herr_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Lcreate_soft</span><span class="p">(</span><span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">srcPath</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">tgtPath</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkCreate</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkAccess</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to write symbolic link [{}]  &quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Trying to write soft link to non-existing path [{}]&quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setProperty_layout</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetCreate</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not configure the H5D layout: the dataset creation property list has not been initialized&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not configure the H5D layout: the H5D layout parameter has not been initialized&quot;</span><span class="p">);</span>
        <span class="k">switch</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">case</span> <span class="nl">H5D_CHUNKED</span><span class="p">:</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Setting layout H5D_CHUNKED&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nl">H5D_COMPACT</span><span class="p">:</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Setting layout H5D_COMPACT&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="nl">H5D_CONTIGUOUS</span><span class="p">:</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Setting layout H5D_CONTIGUOUS&quot;</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Given invalid layout when creating dataset property list. Choose one of H5D_COMPACT,H5D_CONTIGUOUS,H5D_CHUNKED&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">herr_t</span> <span class="n">err</span> <span class="o">=</span> <span class="n">H5Pset_layout</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetCreate</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Could not set layout&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setProperty_chunkDims</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span> <span class="o">!=</span> <span class="n">H5D_CHUNKED</span> <span class="n">and</span> <span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span> <span class="o">!=</span> <span class="n">H5D_CHUNKED</span> <span class="n">and</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Chunk dimensions {} ignored: The given dataset layout is not H5D_CHUNKED&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_simple_extent_type</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">==</span> <span class="n">H5S_SCALAR</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Chunk dimensions ignored: Space is H5S_SCALAR&quot;</span><span class="p">);</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span>   <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDimsMax</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span>    <span class="o">=</span> <span class="n">H5D_CONTIGUOUS</span><span class="p">;</span> <span class="c1">// In case it&#39;s a big text</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">resizeMode</span>  <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">ResizeMode</span><span class="o">::</span><span class="n">DO_NOT_RESIZE</span><span class="p">;</span>
            <span class="n">setProperty_layout</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetCreate</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not configure chunk dimensions: the dataset creation property list has not been initialized&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not configure chunk dimensions: the dataset rank (n dims) has not been initialized&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not configure chunk dimensions: the dataset dimensions have not been initialized&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDims</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()))</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not set chunk dimensions properties: Rank mismatch: dataset dimensions {} has different number of elements than reported rank {}&quot;</span><span class="p">,</span>
                             <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                             <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDims</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not configure chunk dimensions: Rank mismatch: dataset dimensions {} and chunk dimensions {} do not have the same number of elements&quot;</span><span class="p">,</span>
                             <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDims</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">(),</span>
                             <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()));</span>

        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Setting chunk dimensions {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">herr_t</span> <span class="n">err</span> <span class="o">=</span> <span class="n">H5Pset_chunk</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetCreate</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetChunk</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Could not set chunk dimensions&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setProperty_compression</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">checkIfCompressionIsAvailable</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetCreate</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Could not configure compression: field h5_plist_dset_create has not been initialized&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not configure compression: field h5_layout has not been initialized&quot;</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">H5D_CHUNKED</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Compression ignored: Layout is not H5D_CHUNKED&quot;</span><span class="p">);</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span> <span class="n">and</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;Compression level too high: [{}]. Reducing to [9]&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Setting compression level {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">herr_t</span> <span class="n">err</span> <span class="o">=</span> <span class="n">H5Pset_deflate</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetCreate</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">compression</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to set compression level. Check that your HDF5 version has zlib enabled.&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="n">Hyperslab</span> <span class="o">&amp;</span><span class="n">hyperSlab</span><span class="p">,</span> <span class="n">H5S_seloper_t</span> <span class="n">selectOp</span> <span class="o">=</span> <span class="n">H5S_SELECT_OR</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">rank</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to read space rank&quot;</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">dims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rank</span><span class="p">));</span>
        <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">dims</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>
        <span class="c1">// If one of slabOffset or slabExtent is given, then the other must also be given</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">not</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not setup hyperslab metadata: Given hyperslab offset but not extent&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not setup hyperslab metadata: Given hyperslab extent but not offset&quot;</span><span class="p">);</span>

        <span class="c1">// If given, ranks of slabOffset and slabExtent must be identical to each other and to the rank of the existing dataset</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span> <span class="n">and</span> <span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">size</span><span class="p">()))</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span>
                <span class="s">&quot;Could not setup hyperslab metadata: Size mismatch in given hyperslab arrays: offset {} | extent {}&quot;</span><span class="p">,</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>

        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rank</span><span class="p">))</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not setup hyperslab metadata: Hyperslab arrays have different rank compared to the given space: &quot;</span>
                                                <span class="s">&quot;offset {} | extent {} | space dims {}&quot;</span><span class="p">,</span>
                                                <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                <span class="n">dims</span><span class="p">));</span>

        <span class="c1">// If given, slabStride must have the same rank as the dataset</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">stride</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">stride</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rank</span><span class="p">))</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not setup hyperslab metadata: Hyperslab stride has a different rank compared to the dataset: &quot;</span>
                                                <span class="s">&quot;stride {} | dataset dims {}&quot;</span><span class="p">,</span>
                                                <span class="n">hyperSlab</span><span class="p">.</span><span class="n">stride</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                <span class="n">dims</span><span class="p">));</span>
        <span class="c1">// If given, slabBlock must have the same rank as the dataset</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">blocks</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">blocks</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rank</span><span class="p">))</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not setup hyperslab metadata: Hyperslab blocks has a different rank compared to the dataset: &quot;</span>
                                                <span class="s">&quot;blocks {} | dataset dims {}&quot;</span><span class="p">,</span>
                                                <span class="n">hyperSlab</span><span class="p">.</span><span class="n">blocks</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                <span class="n">dims</span><span class="p">));</span>

        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_select_type</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="o">!=</span> <span class="n">H5S_SEL_HYPERSLABS</span><span class="p">)</span> <span class="n">selectOp</span> <span class="o">=</span> <span class="n">H5S_SELECT_SET</span><span class="p">;</span> <span class="c1">// First operation must be H5S_SELECT_SET.</span>

        <span class="cm">/* clang-format off */</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">stride</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">blocks</span><span class="p">)</span>
            <span class="n">H5Sselect_hyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">selectOp</span><span class="p">,</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">stride</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">blocks</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">());</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">stride</span><span class="p">)</span>
            <span class="n">H5Sselect_hyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">selectOp</span><span class="p">,</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">stride</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">blocks</span><span class="p">)</span>
            <span class="n">H5Sselect_hyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">selectOp</span><span class="p">,</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">blocks</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">());</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span> <span class="n">and</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">)</span>
            <span class="n">H5Sselect_hyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">selectOp</span><span class="p">,</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">hyperSlab</span><span class="p">.</span><span class="n">extent</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>

            <span class="cm">/* clang-format on */</span>
<span class="cp">#if H5_VERSION_GE(1, 10, 0)</span>
        <span class="n">htri_t</span> <span class="n">is_regular</span> <span class="o">=</span> <span class="n">H5Sis_regular_hyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">is_regular</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Hyperslab selection is irregular (non-rectangular).</span><span class="se">\n</span><span class="s">&quot;</span>
                                                  <span class="s">&quot;This is not yet supported by h5pp&quot;</span><span class="p">));</span>
        <span class="p">}</span>
<span class="cp">#endif</span>
        <span class="n">htri_t</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">H5Sselect_valid</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">valid</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="n">Hyperslab</span> <span class="nf">slab</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Hyperslab selection is invalid {}&quot;</span><span class="p">,</span> <span class="n">slab</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">selectHyperslabs</span><span class="p">(</span><span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Hyperslab</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">hyperSlabs</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">H5S_seloper_t</span><span class="o">&gt;&gt;</span> <span class="n">hyperSlabSelectOps</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">hyperSlabSelectOps</span> <span class="n">and</span> <span class="n">not</span> <span class="n">hyperSlabSelectOps</span><span class="o">-&gt;</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">hyperSlabs</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">hyperSlabSelectOps</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span>
                <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">slab</span> <span class="p">:</span> <span class="n">hyperSlabs</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">slab</span><span class="p">,</span> <span class="n">hyperSlabSelectOps</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
            <span class="k">else</span>
                <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="n">hyperSlabs</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">num</span><span class="o">++</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">hyperSlabs</span><span class="p">[</span><span class="n">num</span><span class="p">],</span> <span class="n">hyperSlabSelectOps</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">(</span><span class="n">num</span><span class="p">));</span>

        <span class="p">}</span> <span class="k">else</span>
            <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">slab</span> <span class="p">:</span> <span class="n">hyperSlabs</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">slab</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setSpaceExtent</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">h5Space</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">dims</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;&gt;</span> <span class="n">maxDims</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_simple_extent_type</span><span class="p">(</span><span class="n">h5Space</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5S_SCALAR</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dims</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="k">return</span><span class="p">;</span>
        <span class="n">herr_t</span> <span class="n">err</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">maxDims</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dims</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">maxDims</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Rank mismatch in dimensions {} and max dimensions {}&quot;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">maxDims</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span> <span class="n">maxDimsLong</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">dim</span> <span class="p">:</span> <span class="n">maxDims</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">dim</span> <span class="o">==</span> <span class="n">H5S_UNLIMITED</span><span class="p">)</span>
                    <span class="n">maxDimsLong</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="n">maxDimsLong</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dim</span><span class="p">));</span>
            <span class="p">}</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Setting dataspace extents: dims {} | max dims {}&quot;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">maxDimsLong</span><span class="p">);</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">H5Sset_extent_simple</span><span class="p">(</span><span class="n">h5Space</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dims</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">dims</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">maxDims</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">());</span>
            <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to set extents on space: dims {} | max dims {}&quot;</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="n">maxDims</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Setting dataspace extents: dims {}&quot;</span><span class="p">,</span> <span class="n">dims</span><span class="p">);</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">H5Sset_extent_simple</span><span class="p">(</span><span class="n">h5Space</span><span class="p">,</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dims</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">dims</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to set extents on space. Dims {}&quot;</span><span class="p">,</span> <span class="n">dims</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">setSpaceExtent</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;Could not set space extent: the space is not initialized&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="o">-&gt;</span><span class="n">valid</span><span class="p">())</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Could not set space extent. Space is not valid&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_simple_extent_type</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">==</span> <span class="n">H5S_SCALAR</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Could not set space extent: dataset dimensions are not defined&quot;</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span> <span class="n">and</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">H5D_CHUNKED</span> <span class="n">and</span> <span class="n">not</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDimsMax</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Chunked datasets are unlimited unless told explicitly otherwise</span>
            <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDimsMax</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">()),</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">std</span><span class="o">::</span><span class="n">fill_n</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDimsMax</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDimsMax</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">(),</span> <span class="n">H5S_UNLIMITED</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">setSpaceExtent</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetDimsMax</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to set extent on dataset {} </span><span class="se">\n</span><span class="s"> Reason {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()));</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">extendSpace</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">dim</span><span class="p">,</span> <span class="k">const</span> <span class="n">hsize_t</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Extending space dimension [{}] to extent [{}]&quot;</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">extent</span><span class="p">);</span>
        <span class="c1">// Retrieve the current extent of this space</span>
        <span class="k">const</span> <span class="kt">int</span>            <span class="n">oldRank</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">oldDims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">oldRank</span><span class="p">));</span>
        <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">oldDims</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>

        <span class="c1">// We may need to change the rank, for instance, if we are appending a new column</span>
        <span class="c1">// to a vector of size n, so it becomes an (n x 2) &quot;matrix&quot;.</span>
        <span class="k">const</span> <span class="kt">int</span>            <span class="n">newRank</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">oldRank</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">newDims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">newRank</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">oldDims</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">oldDims</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">newDims</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
        <span class="n">newDims</span><span class="p">[</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dim</span><span class="p">)]</span> <span class="o">=</span> <span class="n">extent</span><span class="p">;</span>
        <span class="n">setSpaceExtent</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">newDims</span><span class="p">);</span>
        <span class="c1">//        H5Sset_extent_simple(space,newRank,newDims.data(),nullptr);</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">extendDataset</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span> <span class="o">&amp;</span><span class="n">dataset</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">dim</span><span class="p">,</span> <span class="k">const</span> <span class="n">hsize_t</span> <span class="n">extent</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Retrieve the current size of the memSpace (act as if you don&#39;t know its size and want to append)</span>
        <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="n">space</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataset</span><span class="p">);</span>
        <span class="n">extendSpace</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">extent</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">extendDataset</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span>         <span class="n">loc</span><span class="p">,</span>
                              <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>    <span class="n">datasetRelativeName</span><span class="p">,</span>
                              <span class="k">const</span> <span class="kt">int</span>           <span class="n">dim</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">hsize_t</span>       <span class="n">extent</span><span class="p">,</span>
                              <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">linkExists</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span>
                              <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span>    <span class="n">dsetAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">auto</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">openLink</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5d</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">datasetRelativeName</span><span class="p">,</span> <span class="n">linkExists</span><span class="p">,</span> <span class="n">dsetAccess</span><span class="p">);</span>
        <span class="n">extendDataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">extent</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kt">void</span> <span class="n">extendDataset</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">dsetPath</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef H5PP_EIGEN3</span>
        <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_core_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">extendDataset</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">dsetPath</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">rows</span><span class="p">());</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5d</span>             <span class="n">dataSet</span>   <span class="o">=</span> <span class="n">openLink</span><span class="o">&lt;</span><span class="n">hid</span><span class="o">::</span><span class="n">h5d</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">dsetPath</span><span class="p">);</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span>             <span class="n">fileSpace</span> <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">dataSet</span><span class="p">);</span>
            <span class="kt">int</span>                  <span class="n">ndims</span>     <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">fileSpace</span><span class="p">);</span>
            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">dims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ndims</span><span class="p">));</span>
            <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">fileSpace</span><span class="p">,</span> <span class="n">dims</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>
            <span class="n">H5Sclose</span><span class="p">(</span><span class="n">fileSpace</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">cols</span><span class="p">()))</span> <span class="n">extendDataset</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">dsetPath</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">cols</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span>
<span class="cp">#endif</span>
        <span class="p">{</span>
            <span class="n">extendDataset</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">dsetPath</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">extendDataset</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">appDimensions</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">axis</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We use this function to EXTEND the dataset to APPEND given data</span>
        <span class="n">info</span><span class="p">.</span><span class="n">assertResizeReady</span><span class="p">();</span>
        <span class="kt">int</span> <span class="n">appRank</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">appDimensions</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// These are resized on the fly</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// Sanity checks</span>
            <span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">axis</span><span class="p">))</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not append to dataset [{}] along axis {}: Dataset rank ({}) must be strictly larger than the given axis ({})&quot;</span><span class="p">,</span>
                                                      <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                      <span class="n">axis</span><span class="p">,</span>
                                                      <span class="n">info</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                      <span class="n">axis</span><span class="p">));</span>
            <span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">appRank</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Cannot append to dataset [{}] along axis {}: Dataset rank {} &lt; appended rank {}&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">axis</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">appRank</span><span class="p">));</span>

            <span class="c1">// If we have a dataset with dimensions ijkl and we want to append along j, say, then the remaining</span>
            <span class="c1">// ikl should be at least as large as the corresponding dimensions on the given data.</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">appDimensions</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">idx</span> <span class="o">!=</span> <span class="n">axis</span> <span class="n">and</span> <span class="n">appDimensions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">idx</span><span class="p">])</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not append to dataset [{}] along axis {}: Dimension {} size mismatch: data {} &gt; dset{}&quot;</span><span class="p">,</span>
                                                          <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                          <span class="n">axis</span><span class="p">,</span>
                                                          <span class="n">idx</span><span class="p">,</span>
                                                          <span class="n">appDimensions</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
                                                          <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">idx</span><span class="p">]));</span>

            <span class="c1">// Compute the new dset dimension. Note that dataRank &lt;= dsetRank,</span>
            <span class="c1">// For instance when we add a column to a matrix, the column may be an nx1 vector.</span>
            <span class="c1">// Therefore we embed the data dimensions in a (possibly) higher-dimensional space</span>
            <span class="k">auto</span> <span class="n">embeddedDims</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">()),</span> <span class="mi">1</span><span class="p">);</span>
            <span class="n">std</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">appDimensions</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">appDimensions</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">embeddedDims</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span> <span class="c1">// In the example above, we get nx1</span>
            <span class="k">auto</span> <span class="n">oldAxisSize</span>  <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">axis</span><span class="p">];</span>                             <span class="c1">// Will need this later when drawing the hyperspace</span>
            <span class="k">auto</span> <span class="n">newAxisSize</span>  <span class="o">=</span> <span class="n">embeddedDims</span><span class="p">[</span><span class="n">axis</span><span class="p">];</span>                                      <span class="c1">// Will need this later when drawing the hyperspace</span>
            <span class="k">auto</span> <span class="n">newDsetDims</span>  <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
            <span class="n">newDsetDims</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldAxisSize</span> <span class="o">+</span> <span class="n">newAxisSize</span><span class="p">;</span>

            <span class="c1">// Set the new dimensions</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">oldInfoStr</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">getLogLevel</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">oldInfoStr</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">string</span><span class="p">();</span>
            <span class="n">herr_t</span> <span class="n">err</span> <span class="o">=</span> <span class="n">H5Dset_extent</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">newDsetDims</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
            <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to set extent {} on dataset [{}]&quot;</span><span class="p">,</span> <span class="n">newDsetDims</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
            <span class="p">}</span>
            <span class="c1">// By default, all the space (old and new) is selected</span>
            <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span> <span class="o">=</span> <span class="n">newDsetDims</span><span class="p">;</span>
            <span class="n">info</span><span class="p">.</span><span class="n">h5Space</span>  <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Dset</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">());</span> <span class="c1">// Needs to be refreshed after H5Dset_extent</span>
            <span class="n">info</span><span class="p">.</span><span class="n">dsetByte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Type</span><span class="p">);</span>
            <span class="n">info</span><span class="p">.</span><span class="n">dsetSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="n">info</span><span class="p">.</span><span class="n">dsetRank</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getRank</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>

            <span class="c1">// Now se select the space on the extended dataset where the given data will fit</span>
            <span class="c1">// Draw the target space on a hyperslab</span>
            <span class="n">Hyperslab</span> <span class="n">slab</span><span class="p">;</span>
            <span class="n">slab</span><span class="p">.</span><span class="n">extent</span>               <span class="o">=</span> <span class="n">embeddedDims</span><span class="p">;</span>
            <span class="n">slab</span><span class="p">.</span><span class="n">offset</span>               <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">dsetRank</span><span class="p">.</span><span class="n">value</span><span class="p">()),</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">slab</span><span class="p">.</span><span class="n">offset</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">oldAxisSize</span><span class="p">;</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">selectHyperslab</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">slab</span><span class="p">);</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Extended dataset </span><span class="se">\n</span><span class="s"> </span><span class="se">\t</span><span class="s"> old: {} </span><span class="se">\n</span><span class="s"> </span><span class="se">\t</span><span class="s"> new: {}&quot;</span><span class="p">,</span> <span class="n">oldInfoStr</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">extendDataset</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">DataInfo</span> <span class="o">&amp;</span><span class="n">dataInfo</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">axis</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We use this function to EXTEND the dataset to APPEND given data</span>
        <span class="n">dataInfo</span><span class="p">.</span><span class="n">assertWriteReady</span><span class="p">();</span>
        <span class="n">extendDataset</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">dataDims</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">axis</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">resizeDataset</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">newDimensions</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">h5pp</span><span class="o">::</span><span class="n">ResizeMode</span><span class="o">&gt;</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">mode</span><span class="p">)</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">resizeMode</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">mode</span><span class="p">)</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">ResizeMode</span><span class="o">::</span><span class="n">RESIZE_TO_FIT</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">ResizeMode</span><span class="o">::</span><span class="n">DO_NOT_RESIZE</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Layout</span> <span class="n">and</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">H5D_CHUNKED</span><span class="p">)</span> <span class="k">switch</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Layout</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">case</span> <span class="nl">H5D_COMPACT</span><span class="p">:</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Datasets with H5D_COMPACT layout cannot be resized&quot;</span><span class="p">);</span>
                <span class="k">case</span> <span class="nl">H5D_CONTIGUOUS</span><span class="p">:</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Datasets with H5D_CONTIGUOUS layout cannot be resized&quot;</span><span class="p">);</span>
                <span class="k">default</span><span class="o">:</span> <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Could not resize dataset: Path undefined&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not resize dataset [{}]: info.h5Space undefined&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Type</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not resize dataset [{}]: info.h5Type undefined&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_simple_extent_type</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">==</span> <span class="n">H5S_SCALAR</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// These are not supposed to be resized. Typically strings</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>                   <span class="c1">// These are resized on the fly</span>
        <span class="n">info</span><span class="p">.</span><span class="n">assertResizeReady</span><span class="p">();</span>

        <span class="c1">// Return if there is no change compared to the current dimensions</span>
        <span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">newDimensions</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="c1">// Compare ranks</span>
        <span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">newDimensions</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not resize dataset [{}]: &quot;</span>
                                                  <span class="s">&quot;Rank mismatch: &quot;</span>
                                                  <span class="s">&quot;The given dimensions {} must have the same number of elements as the target dimensions {}&quot;</span><span class="p">,</span>
                                                  <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                  <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                  <span class="n">newDimensions</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">ResizeMode</span><span class="o">::</span><span class="n">INCREASE_ONLY</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">bool</span> <span class="n">allDimsAreSmaller</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">newDimensions</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span><span class="p">(</span><span class="n">newDimensions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">idx</span><span class="p">])</span> <span class="n">allDimsAreSmaller</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">allDimsAreSmaller</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">oldInfoStr</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">getLogLevel</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="n">oldInfoStr</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">string</span><span class="p">();</span>
        <span class="c1">// Chunked datasets can shrink and grow in any direction</span>
        <span class="c1">// Non-chunked datasets can&#39;t be resized at all</span>

        <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">newDimensions</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">newDimensions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetDimsMax</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">idx</span><span class="p">])</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not resize dataset [{}]: &quot;</span>
                                                      <span class="s">&quot;Dimension size error: &quot;</span>
                                                      <span class="s">&quot;The target dimensions {} are larger than the maximum dimensions {} for this dataset. &quot;</span>
                                                      <span class="s">&quot;Consider creating the dataset with larger maximum dimensions or use H5D_CHUNKED layout to enable unlimited resizing&quot;</span><span class="p">,</span>
                                                      <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                      <span class="n">newDimensions</span><span class="p">,</span>
                                                      <span class="n">info</span><span class="p">.</span><span class="n">dsetDimsMax</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="p">}</span>

        <span class="n">herr_t</span> <span class="n">err</span> <span class="o">=</span> <span class="n">H5Dset_extent</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">newDimensions</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to resize dataset [{}] from dimensions {} to {}&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">newDimensions</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="c1">// By default, all the space (old and new) is selected</span>
        <span class="n">info</span><span class="p">.</span><span class="n">dsetDims</span> <span class="o">=</span> <span class="n">newDimensions</span><span class="p">;</span>
        <span class="n">info</span><span class="p">.</span><span class="n">h5Space</span>  <span class="o">=</span> <span class="n">H5Dget_space</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Dset</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">());</span> <span class="c1">// Needs to be refreshed after H5Dset_extent</span>
        <span class="n">info</span><span class="p">.</span><span class="n">dsetByte</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Type</span><span class="p">);</span>
        <span class="n">info</span><span class="p">.</span><span class="n">dsetSize</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Resized dataset </span><span class="se">\n</span><span class="s"> </span><span class="se">\t</span><span class="s"> old: {} </span><span class="se">\n</span><span class="s"> </span><span class="se">\t</span><span class="s"> new: {}&quot;</span><span class="p">,</span> <span class="n">oldInfoStr</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">resizeDataset</span><span class="p">(</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">DataInfo</span> <span class="o">&amp;</span><span class="n">dataInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// We use this function to RESIZE the dataset to FIT given data</span>
        <span class="n">dataInfo</span><span class="p">.</span><span class="n">assertWriteReady</span><span class="p">();</span>
        <span class="n">resizeDataset</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">dataDims</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">resizeData</span><span class="p">(</span><span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">bytes</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This function is used when reading data from file into memory.</span>
        <span class="c1">// It resizes the data so the space in memory can fit the data read from file.</span>
        <span class="c1">// Note that this resizes the data to fit the bounding box of the data selected in the fileSpace.</span>
        <span class="c1">// A selection of elements in memory space must occurr after calling this function.</span>
        <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">std</span><span class="o">::</span><span class="n">is_array_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span> <span class="c1">// h5pp never uses malloc</span>
        <span class="k">if</span><span class="p">(</span><span class="n">bytes</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tget_class</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
                <span class="c1">// Minus one: String resize allocates the null-terminator automatically, and bytes is the number of characters including null-terminator</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">});</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_iterable_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// We have a container such as std::vector&lt;std::string&gt; here, and the dataset may have multiple string elements</span>
                <span class="k">auto</span> <span class="n">size</span> <span class="o">=</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">)});</span>
                <span class="c1">// In variable length arrays each string element is dynamically resized when read.</span>
                <span class="c1">// For fixed-size we can resize already.</span>
                <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">type</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">auto</span> <span class="n">fixedStringSize</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Subtract null terminator</span>
                    <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">str</span> <span class="p">:</span> <span class="n">data</span><span class="p">)</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">resizeData</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="p">{</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">fixedStringSize</span><span class="p">)});</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not resize given container for text data: Unrecognized type for text [{}]&quot;</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()));</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_simple_extent_type</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5S_SCALAR</span><span class="p">)</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">)});</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="kt">int</span>                  <span class="n">rank</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">space</span><span class="p">);</span> <span class="c1">// This will define the bounding box of the selected elements in the file space</span>
            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">extent</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
            <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">extent</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">extent</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">bytes</span> <span class="o">!=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Size mismatch after resize: data [{}] bytes | dset [{}] bytes &quot;</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getBytesTotal</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bytes</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">resizeData</span><span class="p">(</span><span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">dsetByte</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">resizeData</span><span class="p">(</span><span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">AttrInfo</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">attrByte</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">getSpaceString</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">space</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">msg</span><span class="p">;</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot; | size {}&quot;</span><span class="p">,</span> <span class="n">H5Sget_simple_extent_npoints</span><span class="p">(</span><span class="n">space</span><span class="p">)));</span>
        <span class="kt">int</span>                  <span class="n">rank</span> <span class="o">=</span> <span class="n">H5Sget_simple_extent_ndims</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hsize_t</span><span class="o">&gt;</span> <span class="n">dims</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rank</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
        <span class="n">H5Sget_simple_extent_dims</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">dims</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span> <span class="k">nullptr</span><span class="p">);</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot; | rank {}&quot;</span><span class="p">,</span> <span class="n">rank</span><span class="p">));</span>
        <span class="n">msg</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot; | dims {}&quot;</span><span class="p">,</span> <span class="n">dims</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Sget_select_type</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5S_SEL_HYPERSLABS</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Hyperslab</span> <span class="n">slab</span><span class="p">(</span><span class="n">space</span><span class="p">);</span>
            <span class="n">msg</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">slab</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">msg</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">assertSpacesEqual</span><span class="p">(</span><span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">dataSpace</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5s</span> <span class="o">&amp;</span><span class="n">dsetSpace</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5t</span> <span class="o">&amp;</span><span class="n">h5Type</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">h5Type</span><span class="p">)</span> <span class="n">or</span> <span class="n">H5Tget_class</span><span class="p">(</span><span class="n">h5Type</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5T_STRING</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Strings are a special case, e.g. we can write multiple string elements into just one.</span>
            <span class="c1">// Also space is allocated on the fly during read by HDF5.. so size comparisons are useless here.</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//        if(h5_layout == H5D_CHUNKED) return; // Chunked layouts are allowed to differ</span>
        <span class="n">htri_t</span> <span class="n">equal</span> <span class="o">=</span> <span class="n">H5Sextent_equal</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">,</span> <span class="n">dsetSpace</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">equal</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5S_sel_type</span> <span class="n">dataSelType</span> <span class="o">=</span> <span class="n">H5Sget_select_type</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">);</span>
            <span class="n">H5S_sel_type</span> <span class="n">dsetSelType</span> <span class="o">=</span> <span class="n">H5Sget_select_type</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">dataSelType</span> <span class="o">==</span> <span class="n">H5S_sel_type</span><span class="o">::</span><span class="n">H5S_SEL_HYPERSLABS</span> <span class="n">or</span> <span class="n">dsetSelType</span> <span class="o">==</span> <span class="n">H5S_sel_type</span><span class="o">::</span><span class="n">H5S_SEL_HYPERSLABS</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">auto</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">);</span>
                <span class="k">auto</span> <span class="n">dsetSize</span> <span class="o">=</span> <span class="n">getSizeSelected</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">dataSize</span> <span class="o">!=</span> <span class="n">dsetSize</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">auto</span> <span class="n">msg1</span> <span class="o">=</span> <span class="n">getSpaceString</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">);</span>
                    <span class="k">auto</span> <span class="n">msg2</span> <span class="o">=</span> <span class="n">getSpaceString</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">);</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Spaces are not equal size </span><span class="se">\n\t</span><span class="s"> data space </span><span class="se">\t</span><span class="s"> {} </span><span class="se">\n\t</span><span class="s"> dset space </span><span class="se">\t</span><span class="s"> {}&quot;</span><span class="p">,</span> <span class="n">msg1</span><span class="p">,</span> <span class="n">msg2</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// One of the maxDims may be H5S_UNLIMITED, in which case, we just check the dimensions</span>
                <span class="k">auto</span> <span class="n">dataDims</span> <span class="o">=</span> <span class="n">getDimensions</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">);</span>
                <span class="k">auto</span> <span class="n">dsetDims</span> <span class="o">=</span> <span class="n">getDimensions</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">getDimensions</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">)</span> <span class="o">==</span> <span class="n">getDimensions</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
                <span class="k">auto</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="n">getSize</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">);</span>
                <span class="k">auto</span> <span class="n">dsetSize</span> <span class="o">=</span> <span class="n">getSize</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">dataSize</span> <span class="o">!=</span> <span class="n">dsetSize</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">auto</span> <span class="n">msg1</span> <span class="o">=</span> <span class="n">getSpaceString</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">);</span>
                    <span class="k">auto</span> <span class="n">msg2</span> <span class="o">=</span> <span class="n">getSpaceString</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">);</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Spaces are not equal size </span><span class="se">\n\t</span><span class="s"> data space </span><span class="se">\t</span><span class="s"> {} </span><span class="se">\n\t</span><span class="s"> dset space </span><span class="se">\t</span><span class="s"> {}&quot;</span><span class="p">,</span> <span class="n">msg1</span><span class="p">,</span> <span class="n">msg2</span><span class="p">));</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">getDimensions</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">)</span> <span class="o">!=</span> <span class="n">getDimensions</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Spaces have different shape:&quot;</span><span class="p">);</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot; data space {}&quot;</span><span class="p">,</span> <span class="n">getSpaceString</span><span class="p">(</span><span class="n">dataSpace</span><span class="p">));</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot; dset space {}&quot;</span><span class="p">,</span> <span class="n">getSpaceString</span><span class="p">(</span><span class="n">dsetSpace</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">equal</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to compare space extents&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">namespace</span> <span class="n">internal</span> <span class="p">{</span>
        <span class="kr">inline</span> <span class="kt">long</span>        <span class="n">maxHits</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="kr">inline</span> <span class="kt">long</span>        <span class="n">maxDepth</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">searchKey</span><span class="p">;</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="n">H5O_type_t</span> <span class="n">ObjType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">InfoType</span><span class="o">&gt;</span>
        <span class="kr">inline</span> <span class="n">herr_t</span> <span class="n">matcher</span><span class="p">([[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="n">hid_t</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="k">const</span> <span class="n">InfoType</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">opdata</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// If object type is the one requested, and name matches the search key, then add it to the match list (a vector&lt;string&gt;)</span>
            <span class="c1">// If the search depth is passed the depth specified, return immediately</span>
            <span class="c1">// Return 0 to continue searching</span>
            <span class="c1">// Return 1 to finish the search. Normally when we&#39;ve reached max search hits.</span>
            <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">nameView</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">maxDepth</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="n">and</span> <span class="n">std</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">nameView</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">nameView</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxDepth</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">auto</span> <span class="n">matchList</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">opdata</span><span class="p">);</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">InfoType</span><span class="p">,</span> <span class="n">H5O_info_t</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">ObjType</span> <span class="n">or</span> <span class="n">ObjType</span> <span class="o">==</span> <span class="n">H5O_TYPE_UNKNOWN</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">searchKey</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="n">or</span> <span class="n">nameView</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">searchKey</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="n">matchList</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">InfoType</span><span class="p">,</span> <span class="n">H5L_info_t</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">H5O_info_t</span> <span class="n">oInfo</span><span class="p">;</span>
                    <span class="n">hid</span><span class="o">::</span><span class="n">h5o</span>   <span class="n">obj_id</span> <span class="o">=</span> <span class="n">H5Oopen</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">H5P_DEFAULT</span><span class="p">);</span>
                    <span class="cm">/* clang-format off */</span>
                    <span class="cp">#if defined(H5Ovisit_vers)</span>
                        <span class="cp">#if H5Ovisit_vers == 1</span>
                            <span class="n">H5Oget_info</span><span class="p">(</span><span class="n">obj_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oInfo</span><span class="p">);</span>
                        <span class="cp">#elif H5Ovisit_vers == 2</span>
                            <span class="n">H5Oget_info2</span><span class="p">(</span><span class="n">obj_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oInfo</span><span class="p">,</span> <span class="n">H5O_INFO_ALL</span><span class="p">);</span>
                        <span class="cp">#elif H5Ovisit_vers == 3</span>
                            <span class="n">H5Oget_info3</span><span class="p">(</span><span class="n">obj_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oInfo</span><span class="p">,</span> <span class="n">H5O_INFO_ALL</span><span class="p">);</span>
                        <span class="cp">#endif</span>
                    <span class="cp">#else</span>
                        <span class="n">H5Oget_info</span><span class="p">(</span><span class="n">obj_id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">oInfo</span><span class="p">);</span>
                    <span class="cp">#endif</span>
                    <span class="cm">/* clang-format on */</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">oInfo</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ObjType</span> <span class="n">or</span> <span class="n">ObjType</span> <span class="o">==</span> <span class="n">H5O_TYPE_UNKNOWN</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">searchKey</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="n">or</span> <span class="n">nameView</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">searchKey</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="n">matchList</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">searchKey</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="n">or</span> <span class="n">nameView</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">searchKey</span><span class="p">)</span> <span class="o">!=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">::</span><span class="n">npos</span><span class="p">)</span> <span class="p">{</span> <span class="n">matchList</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">if</span><span class="p">(</span><span class="n">maxHits</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="n">and</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">matchList</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="n">maxHits</span><span class="p">)</span>
                    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">else</span>
                    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span><span class="p">(...)</span> <span class="p">{</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not match object [{}] | loc_id [{}]&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">id</span><span class="p">));</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">template</span><span class="o">&lt;</span><span class="n">H5O_type_t</span> <span class="n">ObjType</span><span class="o">&gt;</span>
        <span class="kr">inline</span> <span class="k">constexpr</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">getObjTypeName</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">ObjType</span> <span class="o">==</span> <span class="n">H5O_type_t</span><span class="o">::</span><span class="n">H5O_TYPE_DATASET</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;dataset&quot;</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">ObjType</span> <span class="o">==</span> <span class="n">H5O_type_t</span><span class="o">::</span><span class="n">H5O_TYPE_GROUP</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;group&quot;</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">ObjType</span> <span class="o">==</span> <span class="n">H5O_type_t</span><span class="o">::</span><span class="n">H5O_TYPE_UNKNOWN</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">ObjType</span> <span class="o">==</span> <span class="n">H5O_type_t</span><span class="o">::</span><span class="n">H5O_TYPE_NAMED_DATATYPE</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;named datatype&quot;</span><span class="p">;</span>
            <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">ObjType</span> <span class="o">==</span> <span class="n">H5O_type_t</span><span class="o">::</span><span class="n">H5O_TYPE_NTYPES</span><span class="p">)</span>
                <span class="k">return</span> <span class="s">&quot;ntypes&quot;</span><span class="p">;</span>
            <span class="k">else</span>
                <span class="k">return</span> <span class="s">&quot;map&quot;</span><span class="p">;</span> <span class="c1">// Only in HDF5 v 1.12</span>
        <span class="p">}</span>
        <span class="k">template</span><span class="o">&lt;</span><span class="n">H5O_type_t</span> <span class="n">ObjType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
        <span class="kr">inline</span> <span class="n">herr_t</span> <span class="n">visit_by_name</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">root</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">matchList</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">maxDepth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="c1">// Faster when we don&#39;t need to iterate recursively</span>
                <span class="k">return</span> <span class="n">H5Literate_by_name</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">root</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5_INDEX_NAME</span><span class="p">,</span> <span class="n">H5_ITER_NATIVE</span><span class="p">,</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">matcher</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">matchList</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
<span class="cp">#if defined(H5Ovisit_by_name3) || (defined(H5Ovisit_by_name_vers) &amp;&amp; H5Ovisit_by_name_vers == 3)</span>
            <span class="k">return</span> <span class="nf">H5Ovisit_by_name3</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">root</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5_INDEX_NAME</span><span class="p">,</span> <span class="n">H5_ITER_NATIVE</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">matcher</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">matchList</span><span class="p">,</span> <span class="n">H5O_INFO_ALL</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
<span class="cp">#elif defined(H5Ovisit_by_name2) || (defined(H5Ovisit_by_name_vers) &amp;&amp; H5Ovisit_by_name_vers == 2)</span>
            <span class="k">return</span> <span class="nf">H5Ovisit_by_name2</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">root</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5_INDEX_NAME</span><span class="p">,</span> <span class="n">H5_ITER_NATIVE</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">matcher</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">matchList</span><span class="p">,</span> <span class="n">H5O_INFO_ALL</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
<span class="cp">#elif defined(H5Ovisit_by_name1) || (defined(H5Ovisit_by_name_vers) &amp;&amp; H5Ovisit_by_name_vers == 1)</span>
            <span class="k">return</span> <span class="nf">H5Ovisit_by_name1</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">root</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5_INDEX_NAME</span><span class="p">,</span> <span class="n">H5_ITER_NATIVE</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">matcher</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">matchList</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
<span class="cp">#else</span>
            <span class="k">return</span> <span class="nf">H5Ovisit_by_name</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">root</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5_INDEX_NAME</span><span class="p">,</span> <span class="n">H5_ITER_NATIVE</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">matcher</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">matchList</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
<span class="cp">#endif</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="n">H5O_type_t</span> <span class="n">ObjType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">findLinks</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span>      <span class="n">loc</span><span class="p">,</span>
                                              <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">searchKey</span>  <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
                                              <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">searchRoot</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="p">,</span>
                                              <span class="kt">long</span>             <span class="n">maxHits</span>    <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                              <span class="kt">long</span>             <span class="n">maxDepth</span>   <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                              <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span> <span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Search key: {} | target type: {} | search root: {} | max search hits {}&quot;</span><span class="p">,</span> <span class="n">searchKey</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">getObjTypeName</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">searchRoot</span><span class="p">,</span> <span class="n">maxHits</span><span class="p">);</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">matchList</span><span class="p">;</span>
        <span class="n">internal</span><span class="o">::</span><span class="n">maxHits</span>   <span class="o">=</span> <span class="n">maxHits</span><span class="p">;</span>
        <span class="n">internal</span><span class="o">::</span><span class="n">maxDepth</span>  <span class="o">=</span> <span class="n">maxDepth</span><span class="p">;</span>
        <span class="n">internal</span><span class="o">::</span><span class="n">searchKey</span> <span class="o">=</span> <span class="n">searchKey</span><span class="p">;</span>
        <span class="n">herr_t</span> <span class="n">err</span>          <span class="o">=</span> <span class="n">internal</span><span class="o">::</span><span class="n">visit_by_name</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">searchRoot</span><span class="p">,</span> <span class="n">matchList</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to find links of type [{}] while iterating from root [{}]&quot;</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">getObjTypeName</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">searchRoot</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">matchList</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="n">H5O_type_t</span> <span class="n">ObjType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">getContentsOfLink</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string_view</span> <span class="n">linkPath</span><span class="p">,</span> <span class="kt">long</span> <span class="n">maxDepth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="k">const</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5p</span> <span class="o">&amp;</span><span class="n">linkAccess</span> <span class="o">=</span> <span class="n">H5P_DEFAULT</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">contents</span><span class="p">;</span>
        <span class="n">internal</span><span class="o">::</span><span class="n">maxHits</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="n">internal</span><span class="o">::</span><span class="n">maxDepth</span> <span class="o">=</span> <span class="n">maxDepth</span><span class="p">;</span>
        <span class="n">internal</span><span class="o">::</span><span class="n">searchKey</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
        <span class="n">herr_t</span> <span class="n">err</span> <span class="o">=</span> <span class="n">internal</span><span class="o">::</span><span class="n">visit_by_name</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">contents</span><span class="p">,</span> <span class="n">linkAccess</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to iterate link [{}] of type [{}]&quot;</span><span class="p">,</span> <span class="n">linkPath</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">getObjTypeName</span><span class="o">&lt;</span><span class="n">ObjType</span><span class="o">&gt;</span><span class="p">()));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">contents</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">createDataset</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Here we create, the dataset id and set its properties before writing data to it.</span>
        <span class="n">dsetInfo</span><span class="p">.</span><span class="n">assertCreateReady</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetExists</span> <span class="n">and</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetExists</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;No need to create dataset [{}]: exists already&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Creating dataset {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">hid_t</span> <span class="n">dsetId</span> <span class="o">=</span> <span class="n">H5Dcreate</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">getLocId</span><span class="p">(),</span>
                                 <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetPath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                                 <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">plists</span><span class="p">.</span><span class="n">linkCreate</span><span class="p">,</span>
                                 <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetCreate</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5PlistDsetAccess</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetId</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to create dataset {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
        <span class="p">}</span>
        <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span>     <span class="o">=</span> <span class="n">dsetId</span><span class="p">;</span>
        <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetExists</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">createAttribute</span><span class="p">(</span><span class="n">AttrInfo</span> <span class="o">&amp;</span><span class="n">attrInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Here we create, or register, the attribute id and set its properties before writing data to it.</span>
        <span class="n">attrInfo</span><span class="p">.</span><span class="n">assertCreateReady</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">attrExists</span> <span class="n">and</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">attrExists</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;No need to create attribute [{}] in link [{}]: exists already&quot;</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">attrName</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">linkPath</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Creating attribute {}&quot;</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">hid_t</span> <span class="n">attrId</span> <span class="o">=</span> <span class="n">H5Acreate</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Link</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">attrName</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                                 <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5PlistAttrCreate</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5PlistAttrAccess</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">attrId</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to create attribute [{}] for link [{}]&quot;</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">attrName</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">linkPath</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="p">}</span>
        <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Attr</span>     <span class="o">=</span> <span class="n">attrId</span><span class="p">;</span>
        <span class="n">attrInfo</span><span class="p">.</span><span class="n">attrExists</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">getCharPtrVector</span><span class="p">(</span><span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">sv</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// Takes care of std::string</span>
            <span class="n">sv</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// Takes care of char pointers and arrays</span>
            <span class="n">sv</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_iterable_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// Takes care of containers with text</span>
            <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">elem</span> <span class="p">:</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// Takes care of containers with std::string</span>
                    <span class="n">sv</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">elem</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// Takes care of containers  of char pointers and arrays</span>
                    <span class="n">sv</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">elem</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="n">sv</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">&amp;</span><span class="n">elem</span><span class="p">);</span> <span class="c1">// Takes care of other things?</span>
            <span class="p">}</span>
        <span class="k">else</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to get char pointer of datatype [{}]&quot;</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">()));</span>
        <span class="k">return</span> <span class="n">sv</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">writeDataset</span><span class="p">(</span><span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">DataInfo</span> <span class="o">&amp;</span><span class="n">dataInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
<span class="cp">#ifdef H5PP_EIGEN3</span>
        <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_colmajor_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">not</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_1d_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Converting data to row-major storage order&quot;</span><span class="p">);</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">tempRowm</span> <span class="o">=</span> <span class="n">eigen</span><span class="o">::</span><span class="n">to_RowMajor</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="c1">// Convert to Row Major first;</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">writeDataset</span><span class="p">(</span><span class="n">tempRowm</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">,</span> <span class="n">plists</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
<span class="cp">#endif</span>
        <span class="n">dsetInfo</span><span class="p">.</span><span class="n">assertWriteReady</span><span class="p">();</span>
        <span class="n">dataInfo</span><span class="p">.</span><span class="n">assertWriteReady</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">dataSlab</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">dataSlab</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetSlab</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetSlab</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Writing from memory  {}&quot;</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Writing into dataset {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertWriteBufferIsLargeEnough</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertBytesPerElemMatch</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertSpacesEqual</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">herr_t</span>      <span class="n">retval</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dataPtr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">std</span><span class="o">::</span><span class="n">is_array_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">auto</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">getCharPtrVector</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="c1">// When H5T_VARIABLE, this function expects [const char **], which is what we get from vec.data()</span>
            <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dwrite</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">vec</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dwrite</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="o">*</span><span class="n">vec</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_iterable_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="c1">// We have a fixed-size string array now. We have to copy the strings to a contiguous array</span>
                        <span class="c1">// vdata already contains the pointer to each string, and bytes should be the size of the whole array</span>
                        <span class="c1">// including null terminators. so</span>
                        <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">strContiguous</span><span class="p">;</span>
                        <span class="kt">size_t</span>      <span class="n">bytesPerStr</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span> <span class="c1">// Includes null term</span>
                        <span class="n">strContiguous</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">bytesPerStr</span> <span class="o">*</span> <span class="n">vec</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
                        <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vec</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">auto</span> <span class="n">start_src</span> <span class="o">=</span> <span class="n">strContiguous</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="o">+</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">bytesPerStr</span><span class="p">);</span>
                            <span class="n">strncpy</span><span class="p">(</span><span class="n">start_src</span><span class="p">,</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">strnlen</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bytesPerStr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span> <span class="c1">// Do not copy the null term</span>
                        <span class="p">}</span>
                        <span class="n">retval</span> <span class="o">=</span>
                            <span class="n">H5Dwrite</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">strContiguous</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="c1">// Assume contigous array and hope for the best</span>
                        <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dwrite</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">dataPtr</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dwrite</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">dataPtr</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to write into dataset </span><span class="se">\n\t</span><span class="s"> {} </span><span class="se">\n</span><span class="s"> from memory </span><span class="se">\n\t</span><span class="s"> {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">not</span> <span class="n">std</span><span class="o">::</span><span class="n">is_const_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;&gt;&gt;</span>
    <span class="kt">void</span> <span class="n">readDataset</span><span class="p">(</span><span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">DataInfo</span> <span class="o">&amp;</span><span class="n">dataInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">DsetInfo</span> <span class="o">&amp;</span><span class="n">dsetInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// Transpose the data container before reading</span>
<span class="cp">#ifdef H5PP_EIGEN3</span>
        <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_colmajor_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">not</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_1d_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Converting data to row-major storage order&quot;</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">tempRowMajor</span> <span class="o">=</span> <span class="n">eigen</span><span class="o">::</span><span class="n">to_RowMajor</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="c1">// Convert to Row Major first;</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">readDataset</span><span class="p">(</span><span class="n">tempRowMajor</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">,</span> <span class="n">plists</span><span class="p">);</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">eigen</span><span class="o">::</span><span class="n">to_ColMajor</span><span class="p">(</span><span class="n">tempRowMajor</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
<span class="cp">#endif</span>

        <span class="n">dsetInfo</span><span class="p">.</span><span class="n">assertReadReady</span><span class="p">();</span>
        <span class="n">dataInfo</span><span class="p">.</span><span class="n">assertReadReady</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">dataSlab</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">dataSlab</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetSlab</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">dsetSlab</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Reading into memory  {}&quot;</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Reading from dataset {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertReadBufferIsLargeEnough</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertSpacesEqual</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertBytesPerElemMatch</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">herr_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dataPtr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">std</span><span class="o">::</span><span class="n">is_array_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">;</span>

        <span class="c1">// Read the data</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// When H5T_VARIABLE,</span>
            <span class="c1">//      1) H5Dread expects [const char **], which is what we get from vdata.data().</span>
            <span class="c1">//      2) H5Dread allocates memory on each const char * which has to be reclaimed later.</span>
            <span class="c1">// Otherwise,</span>
            <span class="c1">//      1) H5Dread expects [char *], i.e. *vdata.data()</span>
            <span class="c1">//      2) Allocation on char * must be done before reading.</span>

            <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">()))</span> <span class="p">{</span>
                <span class="k">auto</span>                <span class="n">size</span> <span class="o">=</span> <span class="n">H5Sget_select_npoints</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
                <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">vdata</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">));</span> <span class="c1">// Allocate pointers for &quot;size&quot; number of strings</span>
                <span class="c1">// HDF5 allocates space for each string in vdata</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dread</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">H5S_ALL</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                <span class="c1">// Now vdata contains the whole dataset and we need to put the data into the user-given container.</span>
                <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// A vector of strings (vdata) can be put into a single string (data) with entries separated by new-lines</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vdata</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">vdata</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="n">and</span> <span class="n">vdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span> <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">vdata</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">vdata</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_container_of_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">vdata</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">vdata</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;To read text-data, please use std::string or a container of std::string like std::vector&lt;std::string&gt;&quot;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="c1">// Free memory allocated by HDF5</span>
                <span class="n">H5Dvlen_reclaim</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// All the elements in the dataset have the same string size</span>
                <span class="c1">// The whole dataset is read into a contiguous block of memory.</span>
                <span class="kt">size_t</span>      <span class="n">bytesPerString</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span> <span class="c1">// Includes null terminator</span>
                <span class="k">auto</span>        <span class="n">size</span>           <span class="o">=</span> <span class="n">H5Sget_select_npoints</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">fdata</span><span class="p">;</span>
                <span class="n">fdata</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">bytesPerString</span><span class="p">);</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dread</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">fdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                <span class="c1">// Now fdata contains the whole dataset and we need to put the data into the user-given container.</span>
                <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// A vector of strings (fdata) can be put into a single string (data) with entries separated by new-lines</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">fdata</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">bytesPerString</span><span class="p">,</span> <span class="n">bytesPerString</span><span class="p">));</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">fdata</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="sc">&#39;\0&#39;</span><span class="p">),</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">());</span> <span class="c1">// Prune all but the last null terminator</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_container_of_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
                        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Given container of strings has the wrong size: dset size {} | container size {}&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()));</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">strncpy</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">(),</span> <span class="n">fdata</span><span class="p">.</span><span class="n">data</span><span class="p">()</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">bytesPerString</span><span class="p">,</span> <span class="n">bytesPerString</span><span class="p">);</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">erase</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">begin</span><span class="p">(),</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span> <span class="sc">&#39;\0&#39;</span><span class="p">),</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">end</span><span class="p">());</span> <span class="c1">// Prune all but the last null terminator</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;To read text-data, please use std::string or a container of std::string like std::vector&lt;std::string&gt;&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Dread</span><span class="p">(</span><span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Dset</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">plists</span><span class="p">.</span><span class="n">dsetXfer</span><span class="p">,</span> <span class="n">dataPtr</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to read from dataset </span><span class="se">\n\t</span><span class="s"> {} </span><span class="se">\n</span><span class="s"> into memory </span><span class="se">\n\t</span><span class="s"> {}&quot;</span><span class="p">,</span> <span class="n">dsetInfo</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kt">void</span> <span class="n">writeAttribute</span><span class="p">(</span><span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">DataInfo</span> <span class="o">&amp;</span><span class="n">dataInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">AttrInfo</span> <span class="o">&amp;</span><span class="n">attrInfo</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef H5PP_EIGEN3</span>
        <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_colmajor_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">not</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_1d_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Converting attribute data to row-major storage order&quot;</span><span class="p">);</span>
            <span class="k">const</span> <span class="k">auto</span> <span class="n">tempRowm</span> <span class="o">=</span> <span class="n">eigen</span><span class="o">::</span><span class="n">to_RowMajor</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="c1">// Convert to Row Major first;</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">writeAttribute</span><span class="p">(</span><span class="n">tempRowm</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
<span class="cp">#endif</span>
        <span class="n">dataInfo</span><span class="p">.</span><span class="n">assertWriteReady</span><span class="p">();</span>
        <span class="n">attrInfo</span><span class="p">.</span><span class="n">assertWriteReady</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">dataSlab</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">dataSlab</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="k">if</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">attrSlab</span><span class="p">)</span> <span class="n">selectHyperslab</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">attrSlab</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Writing from memory    {}&quot;</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Writing into attribute {}&quot;</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertWriteBufferIsLargeEnough</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertBytesPerElemMatch</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertSpacesEqual</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">herr_t</span>                       <span class="n">retval</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dataPtr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">std</span><span class="o">::</span><span class="n">is_array_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">;</span>

        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">auto</span> <span class="n">vec</span> <span class="o">=</span> <span class="n">getCharPtrVector</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Attr</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">vec</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
            <span class="k">else</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Attr</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="o">*</span><span class="n">vec</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Awrite</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Attr</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataPtr</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to write into attribute </span><span class="se">\n\t</span><span class="s"> {} </span><span class="se">\n</span><span class="s"> from memory </span><span class="se">\n\t</span><span class="s"> {}&quot;</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">not</span> <span class="n">std</span><span class="o">::</span><span class="n">is_const_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;&gt;&gt;</span>
    <span class="kt">void</span> <span class="n">readAttribute</span><span class="p">(</span><span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">DataInfo</span> <span class="o">&amp;</span><span class="n">dataInfo</span><span class="p">,</span> <span class="k">const</span> <span class="n">AttrInfo</span> <span class="o">&amp;</span><span class="n">attrInfo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Transpose the data container before reading</span>
<span class="cp">#ifdef H5PP_EIGEN3</span>
        <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_colmajor_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">not</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_eigen_1d_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Converting data to row-major storage order&quot;</span><span class="p">);</span>
            <span class="k">auto</span> <span class="n">tempRowMajor</span> <span class="o">=</span> <span class="n">eigen</span><span class="o">::</span><span class="n">to_RowMajor</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="c1">// Convert to Row Major first;</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">readAttribute</span><span class="p">(</span><span class="n">tempRowMajor</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">);</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">eigen</span><span class="o">::</span><span class="n">to_ColMajor</span><span class="p">(</span><span class="n">tempRowMajor</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
<span class="cp">#endif</span>
        <span class="n">dataInfo</span><span class="p">.</span><span class="n">assertReadReady</span><span class="p">();</span>
        <span class="n">attrInfo</span><span class="p">.</span><span class="n">assertReadReady</span><span class="p">();</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Reading into memory {}&quot;</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Reading from file   {}&quot;</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertReadBufferIsLargeEnough</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertBytesPerElemMatch</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">assertSpacesEqual</span><span class="p">(</span><span class="n">dataInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">herr_t</span>                 <span class="n">retval</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dataPtr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">std</span><span class="o">::</span><span class="n">is_array_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">;</span>
        <span class="c1">// Read the data</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_text_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// When H5T_VARIABLE,</span>
            <span class="c1">//      1) H5Aread expects [const char **], which is what we get from vdata.data().</span>
            <span class="c1">//      2) H5Aread allocates memory on each const char * which has to be reclaimed later.</span>
            <span class="c1">// Otherwise,</span>
            <span class="c1">//      1) H5Aread expects [char *], i.e. *vdata.data()</span>
            <span class="c1">//      2) Allocation on char * must be done before reading.</span>
            <span class="k">if</span><span class="p">(</span><span class="n">H5Tis_variable_str</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">auto</span>                <span class="n">size</span> <span class="o">=</span> <span class="n">H5Sget_select_npoints</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
                <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">vdata</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">));</span> <span class="c1">// Allocate pointers for &quot;size&quot; number of strings</span>
                <span class="c1">// HDF5 allocates space for each string</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Aread</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Attr</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                <span class="c1">// Now vdata contains the whole dataset and we need to put the data into the user-given container.</span>
                <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// A vector of strings (vdata) can be put into a single string (data) with entries separated by new-lines</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">vdata</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">vdata</span><span class="p">.</span><span class="n">empty</span><span class="p">()</span> <span class="n">and</span> <span class="n">vdata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">)</span> <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">vdata</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">vdata</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_container_of_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">vdata</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">(</span><span class="n">vdata</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;To read text-data, please use std::string or a container of std::string like std::vector&lt;std::string&gt;&quot;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="c1">// Free memory allocated by HDF5</span>
                <span class="n">H5Dvlen_reclaim</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">H5P_DEFAULT</span><span class="p">,</span> <span class="n">vdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// All the elements in the dataset have the same string size</span>
                <span class="c1">// The whole dataset is read into a contiguous block of memory.</span>
                <span class="kt">size_t</span>      <span class="n">bytesPerString</span> <span class="o">=</span> <span class="n">H5Tget_size</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">());</span> <span class="c1">// Includes null terminator</span>
                <span class="k">auto</span>        <span class="n">size</span>           <span class="o">=</span> <span class="n">H5Sget_select_npoints</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Space</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
                <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">fdata</span><span class="p">;</span>
                <span class="n">fdata</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">bytesPerString</span><span class="p">);</span>
                <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Aread</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Attr</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">fdata</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
                <span class="c1">// Now fdata contains the whole dataset and we need to put the data into the user-given container.</span>
                <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// A vector of strings (fdata) can be put into a single string (data) with entries separated by new-lines</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">fdata</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">bytesPerString</span><span class="p">,</span> <span class="n">bytesPerString</span><span class="p">));</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">fdata</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">data</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_container_of_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
                    <span class="n">data</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">));</span>
                    <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">size</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fdata</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">bytesPerString</span><span class="p">,</span> <span class="n">bytesPerString</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;To read text-data, please use std::string or a container of std::string like std::vector&lt;std::string&gt;&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">data</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="sc">&#39;\0&#39;</span><span class="p">),</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">());</span> <span class="c1">// Prune all but the last null terminator</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Aread</span><span class="p">(</span><span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Attr</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">h5Type</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">dataPtr</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to read from attribute </span><span class="se">\n\t</span><span class="s"> {} </span><span class="se">\n</span><span class="s"> into memory </span><span class="se">\n\t</span><span class="s"> {}&quot;</span><span class="p">,</span> <span class="n">attrInfo</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">dataInfo</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">bool</span> <span class="n">fileIsValid</span><span class="p">(</span><span class="k">const</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="o">&amp;</span><span class="n">filePath</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">fs</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">filePath</span><span class="p">)</span> <span class="n">and</span> <span class="n">H5Fis_hdf5</span><span class="p">(</span><span class="n">filePath</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">c_str</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="n">getAvailableFileName</span><span class="p">(</span><span class="k">const</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="o">&amp;</span><span class="n">filePath</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span>      <span class="n">i</span>           <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="n">newFileName</span> <span class="o">=</span> <span class="n">filePath</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">fs</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">newFileName</span><span class="p">))</span> <span class="p">{</span> <span class="n">newFileName</span><span class="p">.</span><span class="n">replace_filename</span><span class="p">(</span><span class="n">filePath</span><span class="p">.</span><span class="n">stem</span><span class="p">().</span><span class="n">string</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="o">+</span> <span class="n">filePath</span><span class="p">.</span><span class="n">extension</span><span class="p">().</span><span class="n">string</span><span class="p">());</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">newFileName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="kr">inline</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="n">getBackupFileName</span><span class="p">(</span><span class="k">const</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="o">&amp;</span><span class="n">filePath</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">int</span>      <span class="n">i</span>           <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="n">newFilePath</span> <span class="o">=</span> <span class="n">filePath</span><span class="p">;</span>
        <span class="k">while</span><span class="p">(</span><span class="n">fs</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">newFilePath</span><span class="p">))</span> <span class="p">{</span> <span class="n">newFilePath</span><span class="p">.</span><span class="n">replace_extension</span><span class="p">(</span><span class="n">filePath</span><span class="p">.</span><span class="n">extension</span><span class="p">().</span><span class="n">string</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;.bak_&quot;</span> <span class="o">+</span> <span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">i</span><span class="o">++</span><span class="p">));</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">newFilePath</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span> <span class="n">convertFileAccessFlags</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">H5F_ACC_FLAGS</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">RENAME</span><span class="p">;</span>
        <span class="k">if</span><span class="p">((</span><span class="n">H5F_ACC_FLAGS</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">H5F_ACC_TRUNC</span> <span class="o">|</span> <span class="n">H5F_ACC_EXCL</span><span class="p">))</span> <span class="o">==</span> <span class="p">(</span><span class="n">H5F_ACC_TRUNC</span> <span class="o">|</span> <span class="n">H5F_ACC_EXCL</span><span class="p">))</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;File access modes H5F_ACC_EXCL and H5F_ACC_TRUNC are mutually exclusive&quot;</span><span class="p">);</span>
        <span class="k">if</span><span class="p">((</span><span class="n">H5F_ACC_FLAGS</span> <span class="o">&amp;</span> <span class="n">H5F_ACC_RDONLY</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5F_ACC_RDONLY</span><span class="p">)</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READONLY</span><span class="p">;</span>
        <span class="k">if</span><span class="p">((</span><span class="n">H5F_ACC_FLAGS</span> <span class="o">&amp;</span> <span class="n">H5F_ACC_RDWR</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5F_ACC_RDWR</span><span class="p">)</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READWRITE</span><span class="p">;</span>
        <span class="k">if</span><span class="p">((</span><span class="n">H5F_ACC_FLAGS</span> <span class="o">&amp;</span> <span class="n">H5F_ACC_EXCL</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5F_ACC_EXCL</span><span class="p">)</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">COLLISION_FAIL</span><span class="p">;</span>
        <span class="k">if</span><span class="p">((</span><span class="n">H5F_ACC_FLAGS</span> <span class="o">&amp;</span> <span class="n">H5F_ACC_TRUNC</span><span class="p">)</span> <span class="o">==</span> <span class="n">H5F_ACC_TRUNC</span><span class="p">)</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">REPLACE</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">permission</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">convertFileAccessFlags</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span> <span class="n">permission</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">H5F_ACC_MODE</span> <span class="o">=</span> <span class="n">H5F_ACC_RDONLY</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">COLLISION_FAIL</span><span class="p">)</span> <span class="n">H5F_ACC_MODE</span> <span class="o">|=</span> <span class="n">H5F_ACC_EXCL</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">REPLACE</span><span class="p">)</span> <span class="n">H5F_ACC_MODE</span> <span class="o">|=</span> <span class="n">H5F_ACC_TRUNC</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">RENAME</span><span class="p">)</span> <span class="n">H5F_ACC_MODE</span> <span class="o">|=</span> <span class="n">H5F_ACC_TRUNC</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READONLY</span><span class="p">)</span> <span class="n">H5F_ACC_MODE</span> <span class="o">|=</span> <span class="n">H5F_ACC_RDONLY</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READWRITE</span><span class="p">)</span> <span class="n">H5F_ACC_MODE</span> <span class="o">|=</span> <span class="n">H5F_ACC_RDWR</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">H5F_ACC_MODE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="n">createFile</span><span class="p">(</span><span class="k">const</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="o">&amp;</span><span class="n">filePath_</span><span class="p">,</span> <span class="k">const</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span> <span class="o">&amp;</span><span class="n">permission</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">fs</span><span class="o">::</span><span class="n">absolute</span><span class="p">(</span><span class="n">filePath_</span><span class="p">);</span>
        <span class="n">fs</span><span class="o">::</span><span class="n">path</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">filePath_</span><span class="p">.</span><span class="n">filename</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">fileIsValid</span><span class="p">(</span><span class="n">filePath</span><span class="p">))</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Pre-existing file may be corrupted [{}]&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READONLY</span><span class="p">)</span> <span class="k">return</span> <span class="n">filePath</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">COLLISION_FAIL</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;[COLLISION_FAIL]: Previous file exists with the same name [{}]&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">RENAME</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">auto</span> <span class="n">newFilePath</span> <span class="o">=</span> <span class="n">getAvailableFileName</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;[RENAME]: Previous file exists. Choosing a new file name [{}] --&gt; [{}]&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">filename</span><span class="p">().</span><span class="n">string</span><span class="p">(),</span> <span class="n">newFilePath</span><span class="p">.</span><span class="n">filename</span><span class="p">().</span><span class="n">string</span><span class="p">());</span>
                <span class="n">filePath</span> <span class="o">=</span> <span class="n">newFilePath</span><span class="p">;</span>
                <span class="n">fileName</span> <span class="o">=</span> <span class="n">filePath</span><span class="p">.</span><span class="n">filename</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READWRITE</span><span class="p">)</span> <span class="k">return</span> <span class="n">filePath</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">BACKUP</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">auto</span> <span class="n">backupPath</span> <span class="o">=</span> <span class="n">getBackupFileName</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;[BACKUP]: Backing up existing file [{}] --&gt; [{}]&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">filename</span><span class="p">().</span><span class="n">string</span><span class="p">(),</span> <span class="n">backupPath</span><span class="p">.</span><span class="n">filename</span><span class="p">().</span><span class="n">string</span><span class="p">());</span>
                <span class="n">fs</span><span class="o">::</span><span class="n">rename</span><span class="p">(</span><span class="n">filePath</span><span class="p">,</span> <span class="n">backupPath</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">REPLACE</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// Do nothing</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READONLY</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;[READONLY]: File does not exist [{}]&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">COLLISION_FAIL</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// Do nothing</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">RENAME</span><span class="p">)</span> <span class="p">{}</span>         <span class="c1">// Do nothing</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READWRITE</span><span class="p">)</span> <span class="p">{}</span>      <span class="c1">// Do nothing;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">BACKUP</span><span class="p">)</span> <span class="p">{}</span>         <span class="c1">// Do nothing</span>
            <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">REPLACE</span><span class="p">)</span> <span class="p">{}</span>        <span class="c1">// Do nothing</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="o">::</span><span class="n">create_directories</span><span class="p">(</span><span class="n">filePath</span><span class="p">.</span><span class="n">parent_path</span><span class="p">()))</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Created directory: {}&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">parent_path</span><span class="p">().</span><span class="n">string</span><span class="p">());</span>
                <span class="k">else</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Directory already exists: {}&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">parent_path</span><span class="p">().</span><span class="n">string</span><span class="p">());</span>
            <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to create directory: {}&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">()));</span> <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// One last sanity check</span>
        <span class="k">if</span><span class="p">(</span><span class="n">permission</span> <span class="o">==</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">FilePermission</span><span class="o">::</span><span class="n">READONLY</span><span class="p">)</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="s">&quot;About to create/truncate a file even though READONLY was specified. This is a programming error!&quot;</span><span class="p">);</span>

        <span class="c1">// Go ahead</span>
        <span class="n">hid_t</span> <span class="n">file</span> <span class="o">=</span> <span class="n">H5Fcreate</span><span class="p">(</span><span class="n">filePath</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5F_ACC_TRUNC</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">fileCreate</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">fileAccess</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">file</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to create file [{}]&quot;</span><span class="p">,</span> <span class="n">filePath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
        <span class="p">}</span>
        <span class="n">H5Fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">fs</span><span class="o">::</span><span class="n">canonical</span><span class="p">(</span><span class="n">filePath</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">createTable</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">,</span> <span class="n">TableInfo</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">info</span><span class="p">.</span><span class="n">assertCreateReady</span><span class="p">();</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Creating table [{}] | num fields {} | record size {} bytes&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">numFields</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">createGroup</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tableGroupName</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="n">plists</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">checkIfLinkExists</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">tableExists</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkAccess</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Table [{}] already exists&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Copy member type data to a vector of hid_t for compatibility.</span>
        <span class="c1">// Note that there is no need to close thes hid_t since info will close them.</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">hid_t</span><span class="o">&gt;</span> <span class="n">fieldTypesHidT</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">fieldTypes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">begin</span><span class="p">(),</span> <span class="n">info</span><span class="p">.</span><span class="n">fieldTypes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">end</span><span class="p">());</span>

        <span class="c1">// Copy member name data to a vector of const char * for compatibility</span>
        <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">fieldNames</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">name</span> <span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">fieldNames</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="n">fieldNames</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
        <span class="kt">int</span> <span class="n">compression</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">compressionLevel</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Only true/false (1/0). Is set to level 6 in HDF5 sources</span>
        <span class="n">H5TBmake_table</span><span class="p">(</span><span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">tableTitle</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                       <span class="n">loc</span><span class="p">,</span>
                       <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                       <span class="n">info</span><span class="p">.</span><span class="n">numFields</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                       <span class="n">info</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                       <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                       <span class="n">fieldNames</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>
                       <span class="n">info</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                       <span class="n">fieldTypesHidT</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span>
                       <span class="n">info</span><span class="p">.</span><span class="n">chunkSize</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                       <span class="k">nullptr</span><span class="p">,</span>
                       <span class="n">compression</span><span class="p">,</span>
                       <span class="k">nullptr</span><span class="p">);</span>

        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Successfully created table [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="n">info</span><span class="p">.</span><span class="n">tableExists</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5f</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">info</span><span class="p">.</span><span class="n">tableFile</span> <span class="o">=</span> <span class="n">loc</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same_v</span><span class="o">&lt;</span><span class="n">h5x</span><span class="p">,</span> <span class="n">hid</span><span class="o">::</span><span class="n">h5g</span><span class="o">&gt;</span><span class="p">)</span> <span class="n">info</span><span class="p">.</span><span class="n">tableGroup</span> <span class="o">=</span> <span class="n">loc</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">appendTableEntries</span><span class="p">(</span><span class="k">const</span> <span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="n">TableInfo</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">size_t</span> <span class="n">numNewRecords</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">getSize</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Appending {} new records to table [{}] | table num records {} | record size {} bytes&quot;</span><span class="p">,</span>
                                 <span class="n">numNewRecords</span><span class="p">,</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>

        <span class="c1">// Make sure the given container and the registered table entry have the same size.</span>
        <span class="c1">// If there is a mismatch here it can cause horrible bugs/segfaults</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_value_type_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">::</span><span class="n">value_type</span><span class="p">)</span> <span class="o">!=</span> <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Size mismatch: Given container of type {} has elements of {} bytes, but the table entries on file are {} bytes each &quot;</span><span class="p">,</span>
                                                      <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">(),</span>
                                                      <span class="k">sizeof</span><span class="p">(</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">::</span><span class="n">value_type</span><span class="p">),</span>
                                                      <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_iterable_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">())</span> <span class="o">!=</span> <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Size mismatch: Given container of type {} has elements of {} bytes, but the table entries on file are {} bytes each &quot;</span><span class="p">,</span>
                                                      <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">(),</span>
                                                      <span class="k">sizeof</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span>
                                                      <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">DataType</span><span class="p">)</span> <span class="o">!=</span> <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Size mismatch: Given data type {} is of {} bytes, but the table entries on file are {} bytes each &quot;</span><span class="p">,</span>
                                                      <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">type_name</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">(),</span>
                                                      <span class="k">sizeof</span><span class="p">(</span><span class="n">DataType</span><span class="p">),</span>
                                                      <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5TBappend_records</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">getTableLocId</span><span class="p">(),</span>
                               <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                               <span class="n">numNewRecords</span><span class="p">,</span>
                               <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                               <span class="n">info</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                               <span class="n">info</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                               <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">H5TBappend_records</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">getTableLocId</span><span class="p">(),</span>
                               <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                               <span class="n">numNewRecords</span><span class="p">,</span>
                               <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                               <span class="n">info</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                               <span class="n">info</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                               <span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">info</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+=</span> <span class="n">numNewRecords</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">addTableEntriesFrom</span><span class="p">(</span><span class="k">const</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">TableInfo</span> <span class="o">&amp;</span><span class="n">srcInfo</span><span class="p">,</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">TableInfo</span> <span class="o">&amp;</span><span class="n">tgtInfo</span><span class="p">,</span> <span class="n">hsize_t</span> <span class="n">srcStartIdx</span><span class="p">,</span> <span class="n">hsize_t</span> <span class="n">tgtStartIdx</span><span class="p">,</span> <span class="n">hsize_t</span> <span class="n">numNewRecords</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">srcInfo</span><span class="p">.</span><span class="n">assertReadReady</span><span class="p">();</span>
        <span class="n">tgtInfo</span><span class="p">.</span><span class="n">assertWriteReady</span><span class="p">();</span>
        <span class="c1">// Sanity checks for table types</span>
        <span class="k">if</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">tableType</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">tableType</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to add table entries: table type mismatch&quot;</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to add table entries: table entry byte size mismatch src {} != tgt {}&quot;</span><span class="p">,</span> <span class="n">srcInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to add table entries: table field sizes mismatch src {} != tgt {}&quot;</span><span class="p">,</span> <span class="n">srcInfo</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to add table entries: table field offsets mismatch src {} != tgt {}&quot;</span><span class="p">,</span> <span class="n">srcInfo</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>

        <span class="c1">// Sanity check for entry ranges</span>
        <span class="k">if</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">srcStartIdx</span> <span class="o">+</span> <span class="n">numNewRecords</span><span class="p">)</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to add table entries: Requeted entries out of bound: src table nrecords {} | src table start entry {} | num entries {}&quot;</span><span class="p">,</span>
                                                  <span class="n">srcInfo</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                  <span class="n">srcStartIdx</span><span class="p">,</span>
                                                  <span class="n">numNewRecords</span><span class="p">));</span>

        <span class="k">if</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">tableFile</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">tableFile</span><span class="p">.</span><span class="n">value</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;adding records to table [{}] from table [{}] | src start entry {} | tgt start entry {} | num entries {} | entry size {}&quot;</span><span class="p">,</span>
                                     <span class="n">srcInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                     <span class="n">tgtInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                     <span class="n">srcStartIdx</span><span class="p">,</span>
                                     <span class="n">tgtStartIdx</span><span class="p">,</span>
                                     <span class="n">numNewRecords</span><span class="p">,</span>
                                     <span class="n">tgtInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="n">H5TBadd_records_from</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">getTableLocId</span><span class="p">(),</span>
                                 <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                                 <span class="n">srcStartIdx</span><span class="p">,</span>
                                 <span class="n">numNewRecords</span><span class="p">,</span>
                                 <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">tgtInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                                 <span class="n">tgtStartIdx</span><span class="p">);</span>

        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// If the locations are on different files we need to make a temporary</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;adding records to table [{}] from table [{}] on different file | src start entry {} | tgt start entry {} | num entries {} | entry size {}&quot;</span><span class="p">,</span>
                                     <span class="n">srcInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                     <span class="n">tgtInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                     <span class="n">srcStartIdx</span><span class="p">,</span>
                                     <span class="n">tgtStartIdx</span><span class="p">,</span>
                                     <span class="n">numNewRecords</span><span class="p">,</span>
                                     <span class="n">tgtInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">byte</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">(</span><span class="n">numNewRecords</span> <span class="o">*</span> <span class="n">tgtInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
            <span class="n">H5TBread_records</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">getTableLocId</span><span class="p">(),</span>
                             <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">srcInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                             <span class="n">srcStartIdx</span><span class="p">,</span>
                             <span class="n">numNewRecords</span><span class="p">,</span>
                             <span class="n">srcInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                             <span class="n">srcInfo</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                             <span class="n">srcInfo</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                             <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>

            <span class="n">H5TBappend_records</span><span class="p">(</span><span class="n">tgtInfo</span><span class="p">.</span><span class="n">getTableLocId</span><span class="p">(),</span>
                               <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">tgtInfo</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                               <span class="n">numNewRecords</span><span class="p">,</span>
                               <span class="n">tgtInfo</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                               <span class="n">tgtInfo</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                               <span class="n">tgtInfo</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                               <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="n">tgtInfo</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+=</span> <span class="n">numNewRecords</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">readTableEntries</span><span class="p">(</span><span class="n">DataType</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">,</span> <span class="k">const</span> <span class="n">TableInfo</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">startIdx</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">numReadRecords</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If none of startIdx or numReadRecords are given:</span>
        <span class="c1">//          If data resizeable: startIdx = 0, numReadRecords = totalRecords</span>
        <span class="c1">//          If data not resizeable: startIdx = last entry, numReadRecords = 1.</span>
        <span class="c1">// If startIdx given but numReadRecords is not:</span>
        <span class="c1">//          If data resizeable -&gt; read from startEntries to the end</span>
        <span class="c1">//          If data not resizeable -&gt; read from startEntries a single entry</span>
        <span class="c1">// If numReadRecords given but startEntries is not -&gt; read the last numReadRecords records</span>

        <span class="n">hsize_t</span> <span class="n">totalRecords</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">startIdx</span> <span class="n">and</span> <span class="n">not</span> <span class="n">numReadRecords</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">startIdx</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="n">totalRecords</span><span class="p">;</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">startIdx</span>       <span class="o">=</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">startIdx</span> <span class="n">and</span> <span class="n">not</span> <span class="n">numReadRecords</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Invalid start record for table [{}] | nrecords [{}] | start entry [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">,</span> <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">numReadRecords</span> <span class="n">and</span> <span class="n">not</span> <span class="n">startIdx</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">numReadRecords</span> <span class="n">and</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span>
                    <span class="s">&quot;Asked for more records than available in table [{}] | nrecords [{}] | num_entries [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">,</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
            <span class="n">startIdx</span> <span class="o">=</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Sanity check</span>
        <span class="k">if</span><span class="p">(</span><span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span><span class="p">)</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Asked for more records than available in table [{}] | nrecords [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span><span class="p">)</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Asked for more records than available in table [{}] | nrecords [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">));</span>

        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Reading table [{}] | read from record {} | read num records {} | available records {} | record size {} bytes&quot;</span><span class="p">,</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>

        <span class="c1">// Make sure the given container and the registered table entry have the same size.</span>
        <span class="c1">// If there is a mismatch here it can cause horrible bugs/segfaults</span>
        <span class="kt">size_t</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_value_type_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">::</span><span class="n">value_type</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_iterable_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">else</span>
            <span class="n">dataSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DataType</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dataSize</span> <span class="o">!=</span> <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">())</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not read from table [{}]: &quot;</span>
                                                  <span class="s">&quot;Size mismatch: &quot;</span>
                                                  <span class="s">&quot;Given data container size is {} bytes per element | &quot;</span>
                                                  <span class="s">&quot;Table is {} bytes per entry&quot;</span><span class="p">,</span>
                                                  <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                  <span class="n">dataSize</span><span class="p">,</span>
                                                  <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>

        <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()});</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">dataPtr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">std</span><span class="o">::</span><span class="n">is_array_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">;</span>
        <span class="n">H5TBread_records</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">getTableLocId</span><span class="p">(),</span>
                         <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                         <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                         <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                         <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                         <span class="n">info</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                         <span class="n">info</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                         <span class="n">dataPtr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">readTableField</span><span class="p">(</span><span class="n">DataType</span> <span class="o">&amp;</span>            <span class="n">data</span><span class="p">,</span>
                               <span class="k">const</span> <span class="n">TableInfo</span> <span class="o">&amp;</span>     <span class="n">info</span><span class="p">,</span>
                               <span class="n">std</span><span class="o">::</span><span class="n">string_view</span>      <span class="n">fieldName</span><span class="p">,</span>
                               <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">startIdx</span>       <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">,</span>
                               <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">numReadRecords</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">nullopt</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// If none of startIdx or numReadRecords are given:</span>
        <span class="c1">//          If data resizeable: startIdx = 0, numReadRecords = totalRecords</span>
        <span class="c1">//          If data not resizeable: startIdx = last entry, numReadRecords = 1.</span>
        <span class="c1">// If startIdx given but numReadRecords is not:</span>
        <span class="c1">//          If data resizeable -&gt; read from startEntries to the end</span>
        <span class="c1">//          If data not resizeable -&gt; read from startEntries a single entry</span>
        <span class="c1">// If numReadRecords given but startEntries is not -&gt; read the last numReadRecords records</span>

        <span class="n">hsize_t</span> <span class="n">totalRecords</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">startIdx</span> <span class="n">and</span> <span class="n">not</span> <span class="n">numReadRecords</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="k">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">startIdx</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="n">totalRecords</span><span class="p">;</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">startIdx</span>       <span class="o">=</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">startIdx</span> <span class="n">and</span> <span class="n">not</span> <span class="n">numReadRecords</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span>
                    <span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Invalid start record for table [{}] | nrecords [{}] | start entry [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">,</span> <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
            <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_resize_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">numReadRecords</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">numReadRecords</span> <span class="n">and</span> <span class="n">not</span> <span class="n">startIdx</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">numReadRecords</span> <span class="n">and</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span><span class="p">)</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span>
                    <span class="s">&quot;Asked for more records than available in table [{}] | nrecords [{}] | num_entries [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">,</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
            <span class="n">startIdx</span> <span class="o">=</span> <span class="n">totalRecords</span> <span class="o">-</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Sanity check</span>
        <span class="k">if</span><span class="p">(</span><span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span><span class="p">)</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Asked for more records than available in table [{}] | nrecords [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">totalRecords</span><span class="p">)</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">logic_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Asked for more records than available in table [{}] | nrecords [{}]&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span> <span class="n">totalRecords</span><span class="p">));</span>

        <span class="c1">// Compute the field index</span>
        <span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">optFieldIdx</span><span class="p">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">info</span><span class="p">.</span><span class="n">fieldNames</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">fieldName</span> <span class="o">==</span> <span class="n">info</span><span class="p">.</span><span class="n">fieldNames</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">idx</span><span class="p">])</span> <span class="p">{</span>
                <span class="n">optFieldIdx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">optFieldIdx</span><span class="p">)</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not read field [{}] from table [{}]: &quot;</span>
                                                  <span class="s">&quot;Could not find field name [{}] | &quot;</span>
                                                  <span class="s">&quot;Available field names are {}&quot;</span><span class="p">,</span>
                                                  <span class="n">fieldName</span><span class="p">,</span>
                                                  <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                  <span class="n">fieldName</span><span class="p">,</span>
                                                  <span class="n">info</span><span class="p">.</span><span class="n">fieldNames</span><span class="p">.</span><span class="n">value</span><span class="p">()));</span>
        <span class="kt">size_t</span> <span class="n">fieldIdx</span>    <span class="o">=</span> <span class="n">optFieldIdx</span><span class="p">.</span><span class="n">value</span><span class="p">();</span>
        <span class="kt">size_t</span> <span class="n">fieldSize</span>   <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">fieldIdx</span><span class="p">];</span>
        <span class="kt">size_t</span> <span class="n">fieldOffset</span> <span class="o">=</span> <span class="n">info</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">()[</span><span class="n">fieldIdx</span><span class="p">];</span>

        <span class="c1">// Make sure the given container and the registerd table entry have the same size.</span>
        <span class="c1">// If there is a mismatch here it can cause horrible bugs/segfaults</span>
        <span class="kt">size_t</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_value_type_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">typename</span> <span class="n">DataType</span><span class="o">::</span><span class="n">value_type</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">and</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">is_iterable_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">());</span>
        <span class="k">else</span>
            <span class="n">dataSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DataType</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="n">dataSize</span> <span class="o">!=</span> <span class="n">fieldSize</span><span class="p">)</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not read field [{}] from table [{}]: &quot;</span>
                                                  <span class="s">&quot;Size mismatch: &quot;</span>
                                                  <span class="s">&quot;Given data container size is {} bytes per element | &quot;</span>
                                                  <span class="s">&quot;Field size is {} bytes per element&quot;</span><span class="p">,</span>
                                                  <span class="n">fieldName</span><span class="p">,</span>
                                                  <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                                  <span class="n">dataSize</span><span class="p">,</span>
                                                  <span class="n">fieldSize</span><span class="p">));</span>

        <span class="n">h5pp</span><span class="o">::</span><span class="n">util</span><span class="o">::</span><span class="n">resizeData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span><span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">()});</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Reading table [{}] | field [{}] | field index {} | field offset {} | field size {} bytes | read from record {} | read num records {} | available &quot;</span>
                                 <span class="s">&quot;records {} | record size {} bytes&quot;</span><span class="p">,</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">fieldName</span><span class="p">,</span>
                                 <span class="n">fieldIdx</span><span class="p">,</span>
                                 <span class="n">fieldOffset</span><span class="p">,</span>
                                 <span class="n">fieldSize</span><span class="p">,</span>
                                 <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">numRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                                 <span class="n">info</span><span class="p">.</span><span class="n">recordBytes</span><span class="p">.</span><span class="n">value</span><span class="p">());</span>
        <span class="kt">void</span> <span class="o">*</span><span class="n">dataPtr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">has_data_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
        <span class="k">else</span> <span class="k">if</span> <span class="nf">constexpr</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_pointer_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span> <span class="n">or</span> <span class="n">std</span><span class="o">::</span><span class="n">is_array_v</span><span class="o">&lt;</span><span class="n">DataType</span><span class="o">&gt;</span><span class="p">)</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="n">dataPtr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">;</span>
        <span class="n">H5TBread_fields_name</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">getTableLocId</span><span class="p">(),</span>
                             <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">tablePath</span><span class="p">.</span><span class="n">value</span><span class="p">()).</span><span class="n">c_str</span><span class="p">(),</span>
                             <span class="n">util</span><span class="o">::</span><span class="n">safe_str</span><span class="p">(</span><span class="n">fieldName</span><span class="p">).</span><span class="n">c_str</span><span class="p">(),</span>
                             <span class="n">startIdx</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                             <span class="n">numReadRecords</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span>
                             <span class="n">fieldSize</span><span class="p">,</span>
                             <span class="n">info</span><span class="p">.</span><span class="n">fieldOffsets</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                             <span class="n">info</span><span class="p">.</span><span class="n">fieldSizes</span><span class="p">.</span><span class="n">value</span><span class="p">().</span><span class="n">data</span><span class="p">(),</span>
                             <span class="n">dataPtr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">h5x_src</span><span class="p">,</span> <span class="k">typename</span> <span class="n">h5x_tgt</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x_src</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">type</span><span class="o">::</span><span class="n">sfinae</span><span class="o">::</span><span class="n">enable_if_is_h5_loc</span><span class="o">&lt;</span><span class="n">h5x_tgt</span><span class="o">&gt;&gt;</span>
    <span class="kr">inline</span> <span class="kt">void</span>
        <span class="n">copyLink</span><span class="p">(</span><span class="k">const</span> <span class="n">h5x_src</span> <span class="o">&amp;</span><span class="n">srcLocId</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">srcLinkPath</span><span class="p">,</span> <span class="k">const</span> <span class="n">h5x_tgt</span> <span class="o">&amp;</span><span class="n">tgtLocId</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">tgtLinkPath</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Copying link [{}] --&gt; [{}]&quot;</span><span class="p">,</span> <span class="n">srcLinkPath</span><span class="p">,</span> <span class="n">tgtLinkPath</span><span class="p">);</span>
        <span class="c1">// Copy the link srcLinkPath to tgtLinkPath. Note that H5Ocopy does this recursively, so we don&#39;t need</span>
        <span class="c1">// to iterate links recursively here.</span>
        <span class="k">auto</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Ocopy</span><span class="p">(</span><span class="n">srcLocId</span><span class="p">,</span> <span class="n">srcLinkPath</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">tgtLocId</span><span class="p">,</span> <span class="n">tgtLinkPath</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5P_DEFAULT</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkCreate</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not copy link [{}] --&gt; [{}]&quot;</span><span class="p">,</span> <span class="n">srcLinkPath</span><span class="p">,</span> <span class="n">tgtLinkPath</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="kt">void</span> <span class="n">copyLink</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span>  <span class="n">srcFilePath</span><span class="p">,</span>
                         <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span>  <span class="n">srcLinkPath</span><span class="p">,</span>
                         <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span>  <span class="n">tgtFilePath</span><span class="p">,</span>
                         <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span>  <span class="n">tgtLinkPath</span><span class="p">,</span>
                         <span class="n">FilePermission</span>       <span class="n">targetFileCreatePermission</span> <span class="o">=</span> <span class="n">FilePermission</span><span class="o">::</span><span class="n">READWRITE</span><span class="p">,</span>
                         <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span>                     <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Copying link: source link [{}] | source file [{}]  --&gt;  target link [{}] | target file [{}]&quot;</span><span class="p">,</span> <span class="n">srcLinkPath</span><span class="p">,</span> <span class="n">srcFilePath</span><span class="p">,</span> <span class="n">tgtLinkPath</span><span class="p">,</span> <span class="n">tgtFilePath</span><span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="k">auto</span> <span class="n">srcPath</span> <span class="o">=</span> <span class="n">fs</span><span class="o">::</span><span class="n">absolute</span><span class="p">(</span><span class="n">srcFilePath</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">fs</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">srcPath</span><span class="p">))</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not copy link [{}] from file [{}]: source file does not exist [{}]&quot;</span><span class="p">,</span> <span class="n">srcLinkPath</span><span class="p">,</span> <span class="n">srcFilePath</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="k">auto</span> <span class="n">tgtPath</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">createFile</span><span class="p">(</span><span class="n">tgtFilePath</span><span class="p">,</span> <span class="n">targetFileCreatePermission</span><span class="p">,</span> <span class="n">plists</span><span class="p">);</span>

            <span class="n">hid_t</span> <span class="n">hidSrc</span> <span class="o">=</span> <span class="n">H5Fopen</span><span class="p">(</span><span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5F_ACC_RDONLY</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">fileAccess</span><span class="p">);</span>
            <span class="n">hid_t</span> <span class="n">hidTgt</span> <span class="o">=</span> <span class="n">H5Fopen</span><span class="p">(</span><span class="n">tgtPath</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5F_ACC_RDWR</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">fileAccess</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">hidSrc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to open source file [{}] in read-only mode&quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">hidTgt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to open target file [{}] in read-write mode&quot;</span><span class="p">,</span> <span class="n">tgtPath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="p">}</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5f</span> <span class="n">srcFile</span> <span class="o">=</span> <span class="n">hidSrc</span><span class="p">;</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5f</span> <span class="n">tgtFile</span> <span class="o">=</span> <span class="n">hidTgt</span><span class="p">;</span>
            <span class="n">copyLink</span><span class="p">(</span><span class="n">srcFile</span><span class="p">,</span> <span class="n">srcLinkPath</span><span class="p">,</span> <span class="n">tgtFile</span><span class="p">,</span> <span class="n">tgtLinkPath</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not copy link [{}] from file [{}]: {}&quot;</span><span class="p">,</span> <span class="n">srcLinkPath</span><span class="p">,</span> <span class="n">srcFilePath</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span>
        <span class="n">copyFile</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">src</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">tgt</span><span class="p">,</span> <span class="n">FilePermission</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">FilePermission</span><span class="o">::</span><span class="n">COLLISION_FAIL</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Copying file [{}] --&gt; [{}]&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">tgtPath</span> <span class="o">=</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">hdf5</span><span class="o">::</span><span class="n">createFile</span><span class="p">(</span><span class="n">tgt</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">plists</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">srcPath</span> <span class="o">=</span> <span class="n">fs</span><span class="o">::</span><span class="n">absolute</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">not</span> <span class="n">fs</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">srcPath</span><span class="p">))</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not copy file [{}] --&gt; [{}]: source file does not exist [{}]&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="k">if</span><span class="p">(</span><span class="n">tgtPath</span> <span class="o">==</span> <span class="n">srcPath</span><span class="p">)</span> <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;Skipped copying file: source and target files have the same path [{}]&quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>

            <span class="n">hid_t</span> <span class="n">hidSrc</span> <span class="o">=</span> <span class="n">H5Fopen</span><span class="p">(</span><span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5F_ACC_RDONLY</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">fileAccess</span><span class="p">);</span>
            <span class="n">hid_t</span> <span class="n">hidTgt</span> <span class="o">=</span> <span class="n">H5Fopen</span><span class="p">(</span><span class="n">tgtPath</span><span class="p">.</span><span class="n">string</span><span class="p">().</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5F_ACC_RDWR</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">fileAccess</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="n">hidSrc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to open source file [{}] in read-only mode&quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="p">}</span>
            <span class="k">if</span><span class="p">(</span><span class="n">hidTgt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to open target file [{}] in read-write mode&quot;</span><span class="p">,</span> <span class="n">tgtPath</span><span class="p">.</span><span class="n">string</span><span class="p">()));</span>
            <span class="p">}</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5f</span> <span class="n">srcFile</span> <span class="o">=</span> <span class="n">hidSrc</span><span class="p">;</span>
            <span class="n">hid</span><span class="o">::</span><span class="n">h5f</span> <span class="n">tgtFile</span> <span class="o">=</span> <span class="n">hidTgt</span><span class="p">;</span>

            <span class="c1">// Copy all the groups in the file root recursively. Note that H5Ocopy does this recursively, so we don&#39;t need</span>
            <span class="c1">// to iterate links recursively here. Therefore maxDepth = 0</span>
            <span class="kt">long</span> <span class="n">maxDepth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">link</span> <span class="p">:</span> <span class="n">getContentsOfLink</span><span class="o">&lt;</span><span class="n">H5O_TYPE_UNKNOWN</span><span class="o">&gt;</span><span class="p">(</span><span class="n">srcFile</span><span class="p">,</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxDepth</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkAccess</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">link</span> <span class="o">==</span> <span class="s">&quot;.&quot;</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
                <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Copying recursively: [{}]&quot;</span><span class="p">,</span> <span class="n">link</span><span class="p">);</span>
                <span class="k">auto</span> <span class="n">retval</span> <span class="o">=</span> <span class="n">H5Ocopy</span><span class="p">(</span><span class="n">srcFile</span><span class="p">,</span> <span class="n">link</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">tgtFile</span><span class="p">,</span> <span class="n">link</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="n">H5P_DEFAULT</span><span class="p">,</span> <span class="n">plists</span><span class="p">.</span><span class="n">linkCreate</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">retval</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
                    <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Failed to copy file contents with H5Ocopy(srcFile,{},tgtFile,{},H5P_DEFAULT,link_create_propery_list)&quot;</span><span class="p">,</span> <span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="c1">// ... Find out how to copy attributes that are written on the root itself</span>
            <span class="k">return</span> <span class="n">tgtPath</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">H5Eprint</span><span class="p">(</span><span class="n">H5E_DEFAULT</span><span class="p">,</span> <span class="n">stderr</span><span class="p">);</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not copy file [{}] --&gt; [{}]: &quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">what</span><span class="p">()));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">inline</span> <span class="n">fs</span><span class="o">::</span><span class="n">path</span>
        <span class="n">moveFile</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">src</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">tgt</span><span class="p">,</span> <span class="n">FilePermission</span> <span class="n">permission</span> <span class="o">=</span> <span class="n">FilePermission</span><span class="o">::</span><span class="n">COLLISION_FAIL</span><span class="p">,</span> <span class="k">const</span> <span class="n">PropertyLists</span> <span class="o">&amp;</span><span class="n">plists</span> <span class="o">=</span> <span class="n">PropertyLists</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Moving file by copy+remove: [{}] --&gt; [{}]&quot;</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">);</span>
        <span class="k">auto</span> <span class="n">tgtPath</span> <span class="o">=</span> <span class="n">copyFile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">tgt</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="n">plists</span><span class="p">);</span> <span class="c1">// Returns the path to the newly created file</span>
        <span class="k">auto</span> <span class="n">srcPath</span> <span class="o">=</span> <span class="n">fs</span><span class="o">::</span><span class="n">absolute</span><span class="p">(</span><span class="n">src</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">fs</span><span class="o">::</span><span class="n">exists</span><span class="p">(</span><span class="n">tgtPath</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">h5pp</span><span class="o">::</span><span class="n">logger</span><span class="o">::</span><span class="n">log</span><span class="o">-&gt;</span><span class="n">trace</span><span class="p">(</span><span class="s">&quot;Removing file [{}]&quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">());</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="n">fs</span><span class="o">::</span><span class="n">remove</span><span class="p">(</span><span class="n">srcPath</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">exception</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Remove failed. File may be locked [{}] | what(): {} &quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">err</span><span class="p">.</span><span class="n">what</span><span class="p">()));</span> <span class="p">}</span>
            <span class="k">return</span> <span class="n">tgtPath</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span>
            <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="n">h5pp</span><span class="o">::</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;Could not copy file [{}] to target [{}]&quot;</span><span class="p">,</span> <span class="n">srcPath</span><span class="p">.</span><span class="n">string</span><span class="p">(),</span> <span class="n">tgt</span><span class="p">));</span>

        <span class="k">return</span> <span class="n">tgtPath</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020-present, David Ace

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>