@PACKAGE_INIT@

include(CMakeFindDependencyMacro)


# Make sure we use the bundled find modules
list(APPEND CMAKE_MODULE_PATH ${CMAKE_CURRENT_LIST_DIR})

# Determine which dependencies to look for
get_target_property(H5PP_LINK_LIBRARIES h5pp::deps INTERFACE_LINK_LIBRARIES)

if (H5PP_ENABLE_MPI OR MPI::MPI_CXX IN_LIST H5PP_LINK_LIBRARIES)
    if(NOT WIN32)
        find_dependency(MPI REQUIRED)
    endif()
endif ()

# h5pp requires the filesystem header (and possibly stdc++fs library)
if(std::filesystem IN_LIST H5PP_LINK_LIBRARIES)
    find_package(Filesystem COMPONENTS Final Experimental REQUIRED)
endif()

if (H5PP_ENABLE_EIGEN3 OR Eigen3::Eigen IN_LIST H5PP_LINK_LIBRARIES)
    find_dependency(Eigen3 3.3 REQUIRED)
    if(TARGET Eigen3 AND NOT TARGET Eigen3::Eigen)
        add_library(Eigen3::Eigen ALIAS Eigen3)
    endif()
    if(NOT Eigen3::Eigen IN_LIST H5PP_LINK_LIBRARIES)
        target_link_libraries(h5pp::deps INTERFACE Eigen3::Eigen)
    endif()
    target_compile_definitions(h5pp::deps INTERFACE H5PP_USE_EIGEN3)
endif()

if (H5PP_ENABLE_FMT OR fmt::fmt IN_LIST H5PP_LINK_LIBRARIES)
    find_dependency(fmt 6.1.2 REQUIRED)
    if(TARGET fmt AND NOT TARGET fmt::fmt)
        add_library(fmt::fmt ALIAS fmt)
    endif()
    if(NOT fmt::fmt IN_LIST H5PP_LINK_LIBRARIES)
        target_link_libraries(h5pp::deps INTERFACE fmt::fmt)
    endif()
    target_compile_definitions(h5pp::deps INTERFACE H5PP_USE_FMT)
endif()

if (H5PP_ENABLE_SPDLOG OR spdlog::spdlog IN_LIST H5PP_LINK_LIBRARIES)
    find_dependency(spdlog 1.5.0 REQUIRED)
    if(TARGET spdlog AND NOT TARGET spdlog::spdlog)
        add_library(spdlog::spdlog ALIAS spdlog)
    endif()
    if(NOT spdlog::spdlog IN_LIST H5PP_LINK_LIBRARIES)
        target_link_libraries(h5pp::deps INTERFACE spdlog::spdlog)
    endif()
    target_compile_definitions(h5pp::deps INTERFACE H5PP_USE_SPDLOG)
endif()

# HDF5 must be found either way, so set it to required
find_dependency(HDF5 1.8 COMPONENTS C HL REQUIRED)

# FindHDF5.cmake bundled with h5pp defines target HDF5::HDF5.
# CMake version >= 3.20 defines target HDF5::HDF5
# CMake version >= 3.19 Earlier versions of CMake define target hdf5::hdf5_hl
# hdf5-config.cmake from source installations will define target hdf5_hl-<static|shared>
if(HDF5_FOUND)
    if(NOT TARGET HDF5::HDF5 AND HDF5::HDF5 IN_LIST H5PP_LINK_LIBRARIES)
        add_library(HDF5::HDF5 INTERFACE IMPORTED)
        target_link_libraries(HDF5::HDF5 INTERFACE ${HDF5_LIBRARIES})
        target_include_directories(HDF5::HDF5 INTERFACE ${HDF5_INCLUDE_DIRS} ${HDF5_INCLUDE_DIR})
        target_compile_definitions(HDF5::HDF5 INTERFACE ${HDF5_DEFINITIONS})
    endif()
endif()

